# Preamble ----------------------------------------------------------------


# Code author  : Ihsan Fadilah
# Email        : ifadilah@eocru.org
# Last updated : Late February 2022
# Project      : Indonesia Brain Infection Study

# This script provides reproducible code for cleaning the data. It does not have
# the dependency inherent in the script file `01-import-merge.R`. However, this
# code depends on the assumption that the format of data collection remains 
# the same throughout the project. For instance, `feversym` at the Jakarta site
# uses '9' to represent missingness and no new categories of variables are
# introduced to this dataset afterwards. If so, these new categories would be
# mistakenly read as missing data.

# Setup -------------------------------------------------------------------

library(tidyverse)  # Tidy code
library(labelled)   # Label variables
library(here)       # Navigate files
library(lubridate)  # Date-time variable
library(haven)      # Write datasets in SPSS format

# Load --------------------------------------------------------------------

ibis_raw <- here('0-data', 'ibis_all-merged.rds') |> read_rds()
glimpse(ibis_raw) # Take a look at the raw data (after merging)

# Clean ------------------------------------------------------------------

clindastt_jkt <- ibis_raw |> 
  filter(site == 'Jakarta') |> 
  pull(clindastt) |> 
  factor(levels = c('1', '2'), labels = c('Initiated', 'Continued'))

clindastt_bdg <- ibis_raw |> 
  filter(site == 'Bandung') |> 
  pull(clindadtc) |> 
  factor(levels = c('0', '1'), labels = c('Initiated', 'Continued'))

clindastt0 <- c(clindastt_jkt, clindastt_bdg)

clindadtc_jkt <- ibis_raw |> 
  filter(site == 'Jakarta') |> 
  pull(clindadtc) |> 
  ymd()

clindadtc_bdg <- ibis_raw |> 
  filter(site == 'Bandung') |> 
  pull(clindastt) |> 
  ymd()

clindadtc0 <- c(clindadtc_jkt, clindadtc_bdg)

ibis <- ibis_raw |>
  
  # Redefine categories or values
  mutate(
    sex = case_when(site == 'Jakarta' & sex == 'F' ~ 'Female',
                    site == 'Jakarta' & sex == 'M' ~ 'Male',
                    site == 'Bandung' & sex == '0' ~ 'Female',
                    site == 'Bandung' & sex == '1' ~ 'Male',
                    TRUE ~ NA_character_),
    symdays = if_else(is.na(symdays) | symdays == 99999, NA_real_, symdays),
    feversym = case_when(feversym == '1' ~ 'Yes',
                         feversym == '0' ~ 'No',
                         site == 'Jakarta' & feversym == '9' ~ 'Unknown',
                         site == 'Bandung' & feversym == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    feverday = if_else(is.na(feverday) | feverday == 99999, NA_real_, feverday),
    headsym = case_when(headsym == '1' ~ 'Yes',
                        headsym == '0' ~ 'No',
                        site == 'Jakarta' & headsym == '9' ~ 'Unknown',
                        site == 'Bandung' & headsym == '8' ~ 'Unknown',
                        TRUE ~ NA_character_),
    headday = if_else(is.na(headday) | headday == 99999, NA_real_, headday),
    vomitsym = case_when(vomitsym == '1' ~ 'Yes',
                         vomitsym == '0' ~ 'No',
                         site == 'Jakarta' & vomitsym == '9' ~ 'Unknown',
                         site == 'Bandung' & vomitsym == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    vomitday = if_else(is.na(vomitday) | vomitday == 99999, NA_real_, vomitday),
    alconsym = case_when(alconsym == '1' ~ TRUE,
                         alconsym == '0' ~ FALSE,
                         site == 'Jakarta' & alconsym == '9' ~ NA,
                         site == 'Bandung' & alconsym == '8' ~ NA,
                         TRUE ~ NA),
    alconday = if_else(is.na(alconday) | alconday == 99999, NA_real_, alconday),
    bechsym = case_when(bechsym == '1' ~ 'Yes',
                        bechsym == '0' ~ 'No',
                        site == 'Jakarta' & bechsym == '9' ~ 'Unknown',
                        site == 'Bandung' & bechsym == '8' ~ 'Unknown',
                        TRUE ~ NA_character_),
    bechday = if_else(is.na(bechday) | bechday == 99999, NA_real_, bechday),
    seizusym = case_when(seizusym == '1' ~ 'Yes',
                         seizusym == '0' ~ 'No',
                         site == 'Jakarta' & seizusym == '9' ~ 'Unknown',
                         site == 'Bandung' & seizusym == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    seizuonset = if_else(is.na(seizuonset) | seizuonset == 99999,
                         NA_real_, seizuonset),
    cough = case_when(cough == '0' ~ 'None',
                      cough == '1' ~ '<2 weeks',
                      cough == '2' ~ '>2 weeks',
                      site == 'Jakarta' & cough == '9' ~ 'Unknown',
                      site == 'Bandung' & cough == '8' ~ 'Unknown',
                      TRUE ~ NA_character_),
    # cough = ordered(cough, levels = c('None', '<2 weeks', '>2 weeks')),
    htemp = if_else(is.na(htemp) | htemp == 99999, NA_real_, htemp),
    gcs = if_else(is.na(gcs) | gcs == 99999, NA_real_, gcs),
    palsy = case_when(palsy == '1' ~ 'Yes',
                      palsy == '0' ~ 'No',
                      site == 'Jakarta' & palsy == '9' ~ 'Unknown',
                      site == 'Bandung' & palsy == '8' ~ 'Unknown',
                      TRUE ~ NA_character_),
    papille = case_when(papille == '1' ~ 'Yes',
                        papille == '0' ~ 'No',
                        site == 'Jakarta' & papille == '9' ~ 'Unknown',
                        site == 'Bandung' & papille == '8' ~ 'Unknown',
                        TRUE ~ NA_character_),
    neckstiff = case_when(neckstiff == '1' ~ 'Yes',
                          neckstiff == '0' ~ 'No',
                          site == 'Jakarta' & neckstiff == '9' ~ 'Unknown',
                          site == 'Bandung' & neckstiff == '8' ~ 'Unknown',
                          TRUE ~ NA_character_),
    motordef = case_when(motordef == '1' ~ 'Yes',
                         motordef == '0' ~ 'No',
                         site == 'Jakarta' & motordef == '9' ~ 'Unknown',
                         site == 'Bandung' & motordef == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    hemipare = case_when(hemipare == '1' ~ 'Yes',
                         hemipare == '0' ~ 'No',
                         site == 'Jakarta' & hemipare == '9' ~ 'Unknown',
                         site == 'Bandung' & hemipare == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    parapare = case_when(parapare == '1' ~ 'Yes',
                         parapare == '0' ~ 'No',
                         site == 'Jakarta' & parapare == '9' ~ 'Unknown',
                         site == 'Bandung' & parapare == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    tetrapare = case_when(tetrapare == '1' ~ 'Yes',
                          tetrapare == '0' ~ 'No',
                          site == 'Jakarta' & tetrapare == '9' ~ 'Unknown',
                          site == 'Bandung' & tetrapare == '8' ~ 'Unknown',
                          TRUE ~ NA_character_),
    monopare = case_when(monopare == '1' ~ 'Yes',
                         monopare == '0' ~ 'No',
                         site == 'Jakarta' & monopare == '9' ~ 'Unknown',
                         site == 'Bandung' & monopare == '8' ~ 'Unknown',
                         TRUE ~ NA_character_),
    hemovalue = if_else(is.na(hemovalue) | hemovalue == 99999, 
                        NA_real_, hemovalue),
    wcellcvalue = if_else(is.na(wcellcvalue) | wcellcvalue == 99999, 
                          NA_real_, wcellcvalue),
    platevalue = if_else(is.na(platevalue) | platevalue == 99999, 
                         NA_real_, platevalue),
    hivvalue = case_when(hivvalue == '1' ~ 'Positive',
                         hivvalue == '0' ~ 'Negative',
                         site == 'Jakarta' & hivvalue == '9' ~ 'Not done',
                         site == 'Bandung' & hivvalue == '2' ~ 'Not done',
                         TRUE ~ NA_character_),
    cd4value = if_else(is.na(cd4value) | cd4value == 99999, 
                       NA_real_, cd4value),
    antiigg_res = case_when(antiigg_res == '1' ~ 'Positive',
                            antiigg_res == '0' ~ 'Negative',
                            site == 'Jakarta' & antiigg_res == '9' ~ 'Not done',
                            site == 'Bandung' & antiigg_res == '2' ~ 'Not done',
                            TRUE ~ NA_character_),
    hivstt = case_when(hivstt == '1' ~ 'Positive',
                       hivstt == '0' ~ 'Negative',
                         site == 'Jakarta' & hivstt == '9' ~ 'Unknown',
                         site == 'Bandung' & hivstt == '2' ~ 'Unknown',
                         TRUE ~ NA_character_),
    whcellc1 = if_else(is.na(whcellc1) | whcellc1 == 99999, 
                       NA_real_, whcellc1),
    whcellc2 = if_else(is.na(whcellc2) | whcellc2 == 99999, 
                       NA_real_, whcellc2),
    polycellc1 = if_else(is.na(polycellc1) | polycellc1 == 99999, 
                         NA_real_, polycellc1),
    polycellc2 = if_else(is.na(polycellc2) | polycellc2 == 99999, 
                         NA_real_, polycellc2),
    monocellc1 = if_else(is.na(monocellc1) | monocellc1 == 99999, 
                         NA_real_, monocellc1),
    monocellc2 = if_else(is.na(monocellc2) | monocellc2 == 99999, 
                         NA_real_, monocellc2),
    protein1 = if_else(is.na(protein1) | protein1 == 99999, 
                       NA_real_, protein1),
    protein2 = if_else(is.na(protein2) | protein2 == 99999, 
                       NA_real_, protein2),
    pblglucose1 = if_else(is.na(pblglucose1) | pblglucose1 == 99999, 
                          NA_real_, pblglucose1),
    pblglucose2 = if_else(is.na(pblglucose2) | pblglucose2 == 99999, 
                          NA_real_, pblglucose2),
    ratio_glucose1 = if_else(is.na(ratio_glucose1) | ratio_glucose1 == 99999, 
                             NA_real_, ratio_glucose1),
    ratio_glucose2 = if_else(is.na(ratio_glucose2) | ratio_glucose2 == 99999, 
                             NA_real_, ratio_glucose2),
    crag1 = case_when(crag1 == '1' ~ 'Positive',
                      crag1 == '0' ~ 'Negative',
                      site == 'Jakarta' & crag1 == '9' ~ 'Not done',
                      site == 'Bandung' & crag1 == '2' ~ 'Not done',
                      TRUE ~ NA_character_),
    crag2 = case_when(crag2 == '1' ~ 'Positive',
                      crag2 == '0' ~ 'Negative',
                      site == 'Jakarta' & crag2 == '9' ~ 'Not done',
                      site == 'Bandung' & crag2 == '2' ~ 'Not done',
                      TRUE ~ NA_character_),
    xpert1 = case_when(xpert1 == '1' ~ 'Positive',
                       xpert1 == '0' ~ 'Negative',
                       site == 'Jakarta' & xpert1 == '9' ~ 'Not done',
                       site == 'Bandung' & xpert1 == '2' ~ 'Not done',
                       TRUE ~ NA_character_),
    xpert2 = case_when(xpert2 == '1' ~ 'Positive',
                       xpert2 == '0' ~ 'Negative',
                       site == 'Jakarta' & xpert2 == '9' ~ 'Not done',
                       site == 'Bandung' & xpert2 == '2' ~ 'Not done',
                       TRUE ~ NA_character_),
    xpertrif1 = case_when(xpertrif1 == '1' ~ 'RIF-resistant',
                          xpertrif1 == '0' ~ 'RIF-sensitive',
                          TRUE ~ NA_character_),
    xpertrif2 = case_when(xpertrif2 == '1' ~ 'RIF-resistant',
                          xpertrif2 == '0' ~ 'RIF-sensitive',
                          TRUE ~ NA_character_),
    csfcmv1 = case_when(csfcmv1 == '1' ~ 'Positive',
                        csfcmv1 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfcmv1 == '9' ~ 'Not done',
                        site == 'Bandung' & csfcmv1 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfcmv2 = case_when(csfcmv2 == '1' ~ 'Positive',
                        csfcmv2 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfcmv2 == '9' ~ 'Not done',
                        site == 'Bandung' & csfcmv2 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfhsv1 = case_when(csfhsv1 == '1' ~ 'Positive',
                        csfhsv1 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfhsv1 == '9' ~ 'Not done',
                        site == 'Bandung' & csfhsv1 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfhsv2 = case_when(csfhsv2 == '1' ~ 'Positive',
                        csfhsv2 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfhsv2 == '9' ~ 'Not done',
                        site == 'Bandung' & csfhsv2 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfebv1 = case_when(csfebv1 == '1' ~ 'Positive',
                        csfebv1 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfebv1 == '9' ~ 'Not done',
                        site == 'Bandung' & csfebv1 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfebv2 = case_when(csfebv2 == '1' ~ 'Positive',
                        csfebv2 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfebv2 == '9' ~ 'Not done',
                        site == 'Bandung' & csfebv2 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfvzv1 = case_when(csfvzv1 == '1' ~ 'Positive',
                        csfvzv1 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfvzv1 == '9' ~ 'Not done',
                        site == 'Bandung' & csfvzv1 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfvzv2 = case_when(csfvzv2 == '1' ~ 'Positive',
                        csfvzv2 == '0' ~ 'Negative',
                        site == 'Jakarta' & csfvzv2 == '9' ~ 'Not done',
                        site == 'Bandung' & csfvzv2 == '2' ~ 'Not done',
                        TRUE ~ NA_character_),
    csfvdrl1 = case_when(csfvdrl1 == '1' ~ 'Positive',
                         csfvdrl1 == '0' ~ 'Negative',
                         site == 'Jakarta' & csfvdrl1 == '9' ~ 'Not done',
                         site == 'Bandung' & csfvdrl1 == '2' ~ 'Not done',
                         TRUE ~ NA_character_),
    csfvdrl2 = case_when(csfvdrl2 == '1' ~ 'Positive',
                         csfvdrl2 == '0' ~ 'Negative',
                         site == 'Jakarta' & csfvdrl2 == '9' ~ 'Not done',
                         site == 'Bandung' & csfvdrl2 == '2' ~ 'Not done',
                         TRUE ~ NA_character_),
    csftpha1 = case_when(csftpha1 == '1' ~ 'Positive',
                         csftpha1 == '0' ~ 'Negative',
                         site == 'Jakarta' & csftpha1 == '9' ~ 'Not done',
                         site == 'Bandung' & csftpha1 == '2' ~ 'Not done',
                         TRUE ~ NA_character_),
    csftpha2 = case_when(csftpha2 == '1' ~ 'Positive',
                         csftpha2 == '0' ~ 'Negative',
                         site == 'Jakarta' & csftpha2 == '9' ~ 'Not done',
                         site == 'Bandung' & csftpha2 == '2' ~ 'Not done',
                         TRUE ~ NA_character_),
    xraynm = case_when(xraynm == '1' ~ TRUE,
                       xraynm == '0' ~ FALSE,
                       TRUE ~ NA),
    xrayinf = case_when(xrayinf == '1' ~ TRUE,
                        xrayinf == '0' ~ FALSE,
                        TRUE ~ NA),
    xraymili = case_when(xraymili == '1' ~ TRUE,
                         xraymili == '0' ~ FALSE,
                         TRUE ~ NA),
    xraycav = case_when(xraycav == '1' ~ TRUE,
                        xraycav == '0' ~ FALSE,
                        TRUE ~ NA),
    bihernia1 = case_when(bihernia1 == '1' ~ TRUE,
                          bihernia1 == '0' ~ FALSE,
                          TRUE ~ NA),
    bihernia2 = case_when(bihernia2 == '1' ~ TRUE,
                          bihernia2 == '0' ~ FALSE,
                          TRUE ~ NA),
    bihernia3 = case_when(bihernia3 == '1' ~ TRUE,
                          bihernia3 == '0' ~ FALSE,
                          TRUE ~ NA),
    bienceph1 = case_when(bienceph1 == '1' ~ TRUE,
                          bienceph1 == '0' ~ FALSE,
                          TRUE ~ NA),
    bienceph2 = case_when(bienceph2 == '1' ~ TRUE,
                          bienceph2 == '0' ~ FALSE,
                          TRUE ~ NA),
    bienceph3 = case_when(bienceph3 == '1' ~ TRUE,
                          bienceph3 == '0' ~ FALSE,
                          TRUE ~ NA),
    staydur = if_else(is.na(staydur) | staydur == 99999, NA_real_, staydur),
    
    outcome = case_when(                                    # Clarify categories
      site == 'Bandung' & outcome == '0' ~ 'Alive',
      site == 'Bandung' & outcome == '1' ~ 'Dead',
      site == 'Bandung' & outcome == '2' ~ 'Discharged',
      site == 'Bandung' & outcome == '3' ~ 'Self-discharged',
      site == 'Bandung' & outcome == '4' ~ 'Referred to another hospital',
      site == 'Bandung' & outcome == '5' ~ 'Hospitalised',
      
      site == 'Jakarta' & outcome == '1' ~ 'Dead',
      site == 'Jakarta' & outcome == '2' ~ 'Self-discharged',
      site == 'Jakarta' & outcome == '3' ~ 'Discharged',
      site == 'Jakarta' & outcome == '4' ~ 'Referred to another hospital'
      
    ),
    
    etiomtuber = case_when(etiomtuber == '1' ~ TRUE,
                           etiomtuber == '0' ~ FALSE,
                           TRUE ~ NA),
    etmtustt = case_when(site == 'Bandung' & etmtustt == '0' ~ 'Definite',
                         site == 'Bandung' & etmtustt == '1' ~ 'Probable',
                         site == 'Bandung' & etmtustt == '2' ~ 'Possible',
                         site == 'Jakarta' & etmtustt == '1' ~ 'Definite',
                         site == 'Jakarta' & etmtustt == '2' ~ 'Probable',
                         site == 'Jakarta' & etmtustt == '3' ~ 'Possible',
                         TRUE ~ NA_character_),
    etitoxoenc = case_when(etitoxoenc == '1' ~ TRUE,
                           etitoxoenc == '0' ~ FALSE,
                           TRUE ~ NA),
    etitoxostt = case_when(site == 'Bandung' & etitoxostt == '0' ~ 'Definite',
                           site == 'Bandung' & etitoxostt == '1' ~ 'Probable',
                           site == 'Bandung' & etitoxostt == '2' ~ 'Possible',
                           site == 'Jakarta' & etitoxostt == '1' ~ 'Definite',
                           site == 'Jakarta' & etitoxostt == '2' ~ 'Probable',
                           site == 'Jakarta' & etitoxostt == '3' ~ 'Possible',
                           TRUE ~ NA_character_),
    eticryp = case_when(eticryp == '1' ~ TRUE,
                        eticryp == '0' ~ FALSE,
                        TRUE ~ NA),
    eticrypstt = case_when(site == 'Bandung' & eticrypstt == '0' ~ 'Definite',
                           site == 'Bandung' & eticrypstt == '1' ~ 'Probable',
                           site == 'Bandung' & eticrypstt == '2' ~ 'Possible',
                           site == 'Jakarta' & eticrypstt == '1' ~ 'Definite',
                           site == 'Jakarta' & eticrypstt == '2' ~ 'Probable',
                           site == 'Jakarta' & eticrypstt == '3' ~ 'Possible',
                           TRUE ~ NA_character_),
    etibac = case_when(etibac == '1' ~ TRUE,
                       etibac == '0' ~ FALSE,
                       TRUE ~ NA),
    etibacstt = case_when(site == 'Bandung' & etibacstt == '0' ~ 'Definite',
                          site == 'Bandung' & etibacstt == '1' ~ 'Probable',
                          site == 'Bandung' & etibacstt == '2' ~ 'Possible',
                          site == 'Jakarta' & etibacstt == '1' ~ 'Definite',
                          site == 'Jakarta' & etibacstt == '2' ~ 'Probable',
                          site == 'Jakarta' & etibacstt == '3' ~ 'Possible',
                          TRUE ~ NA_character_),
    etivence = case_when(etivence == '1' ~ TRUE,
                         etivence == '0' ~ FALSE,
                         TRUE ~ NA),
    etivencestt = case_when(site == 'Bandung' & etivencestt == '0' ~ 'Definite',
                            site == 'Bandung' & etivencestt == '1' ~ 'Probable',
                            site == 'Bandung' & etivencestt == '2' ~ 'Possible',
                            site == 'Jakarta' & etivencestt == '1' ~ 'Definite',
                            site == 'Jakarta' & etivencestt == '2' ~ 'Probable',
                            site == 'Jakarta' & etivencestt == '3' ~ 'Possible',
                            TRUE ~ NA_character_),
    etiothba = case_when(etiothba == '1' ~ TRUE,
                         etiothba == '0' ~ FALSE,
                         TRUE ~ NA),
    etiothmuco = case_when(etiothmuco == '1' ~ TRUE,
                           etiothmuco == '0' ~ FALSE,
                           TRUE ~ NA),
    etiothbm = case_when(etiothbm == '1' ~ TRUE,
                         etiothbm == '0' ~ FALSE,
                         TRUE ~ NA),
    etiothneu = case_when(etiothneu == '1' ~ TRUE,
                          etiothneu == '0' ~ FALSE,
                          TRUE ~ NA),
    etiohtlym = case_when(etiohtlym == '1' ~ TRUE,
                          etiohtlym == '0' ~ FALSE,
                          TRUE ~ NA),
    etiohnmdar = case_when(etiohnmdar == '1' ~ TRUE,
                           etiohnmdar == '0' ~ FALSE,
                           TRUE ~ NA),
    paticond = case_when(
      site == 'Bandung' & paticond == '0' ~ 'Alive',
      site == 'Bandung' & paticond == '1' ~ 'Dead',
      site == 'Bandung' & paticond == '2' ~ 'Lost to follow up',
      site == 'Jakarta' & paticond == '1' ~ 'Alive',
      site == 'Jakarta' & paticond == '2' ~ 'Dead',
      site == 'Jakarta' & paticond == '3' ~ 'Lost to follow up',
      TRUE ~ NA_character_
      ),
    iscnsinfec = case_when(
      iscnsinfec == '1' ~ TRUE,
      iscnsinfec == '0' ~ FALSE,
      TRUE ~ NA
    ),
    is18 = case_when(
      is18 == '1' ~ TRUE,
      is18 == '0' ~ FALSE,
      TRUE ~ NA
    ),
    issigned = case_when(
      issigned == '1' ~ TRUE,
      issigned == '0' ~ FALSE,
      TRUE ~ NA
    ),
    admisdtc = ymd(admisdtc),
    admistime = case_when(
     site == 'Jakarta' ~ as.character(admistime),
     site == 'Bandung' ~ str_sub(admistime, start = 12, end = -1),
     TRUE ~ NA_character_
    ),
    admistime = hms(admistime),
    neuroinfecdtc = ymd(neuroinfecdtc),
    neuroinfectime = case_when(
      site == 'Jakarta' ~ as.character(neuroinfectime),
      site == 'Bandung' ~ str_sub(neuroinfectime, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    neuroinfectime = hms(neuroinfectime),
    fstdosend = case_when(
      site == 'Jakarta' & fstdosend == 'FALSE' ~ 'Done',
      site == 'Jakarta' & fstdosend == 'TRUE ' ~ 'Not done',
      site == 'Bandung' & fstdosend == '1' ~ 'Done',
      site == 'Bandung' & fstdosend == '0' ~ 'Not done',
      TRUE ~ NA_character_
    ),
    fstdosedtc = ymd(fstdosedtc),
    fstdosetime = case_when(
      site == 'Jakarta' ~ as.character(fstdosetime),
      site == 'Bandung' ~ str_sub(fstdosetime, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    fstdosetime = hms(fstdosetime),
    lumpuncnd = case_when(
      site == 'Jakarta' & lumpuncnd == 'FALSE' ~ 'Done',
      site == 'Jakarta' & lumpuncnd == 'TRUE ' ~ 'Not done',
      site == 'Bandung' & lumpuncnd == '1' ~ 'Done',
      site == 'Bandung' & lumpuncnd == '0' ~ 'Not done',
      TRUE ~ NA_character_
    ),
    lumpuncdtc = ymd(lumpuncdtc),
    lunpunctime = case_when(
      site == 'Jakarta' ~ as.character(lunpunctime),
      site == 'Bandung' ~ str_sub(lunpunctime, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    lunpunctime = hms(lunpunctime),
    enrolldtc = ymd(enrolldtc),
    enrolltime = case_when(
      site == 'Jakarta' ~ as.character(enrolltime),
      site == 'Bandung' ~ str_sub(enrolltime, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    enrolltime = hms(enrolltime),
    isrecrbf = case_when(
      isrecrbf == '1' ~ TRUE,
      isrecrbf == '0' ~ FALSE,
      TRUE ~ NA 
    ),
    mob = case_when(
       site == 'Jakarta' ~ as.numeric(mob),
       site == 'Bandung' ~ str_sub(dob, start = 6, end = 7) |> as.numeric(),
       TRUE ~ NA_real_
    ),
    yob = case_when(
      site == 'Jakarta' ~ as.numeric(yob),
      site == 'Bandung' ~ str_sub(dob, start = 1, end = 4) |> as.numeric(),
      TRUE ~ NA_real_
    ),
    dob = case_when(
      site == 'Jakarta' ~ as.numeric(dob),
      site == 'Bandung' ~ str_sub(dob, start = -2, end = -1) |> as.numeric(),
      TRUE ~ NA_real_
    ),
    studypl = case_when(
       studypl == '1' ~ as.numeric(studypl),
       studypl == '2' ~ as.numeric(studypl),
       studypl == '3' ~ as.numeric(studypl),
       TRUE ~ NA_real_
    ),
    refstt = case_when(
      refstt == '1' ~ as.numeric(refstt),
      refstt == '2' ~ as.numeric(refstt),
      refstt == '3' ~ as.numeric(refstt),
      TRUE ~ NA_real_
    ),
    fstsymdtc = ymd(fstsymdtc),
    fevercomp = if_else(fevercomp == '1', TRUE, FALSE),
    headcomp = if_else(headcomp == '1', TRUE, FALSE),
    vomitcomp = if_else(vomitcomp == '1', TRUE, FALSE),
    alconcomp = if_else(alconcomp == '1', TRUE, FALSE),
    lethsym = case_when(
      lethsym == '1' ~ as.numeric(lethsym),
      lethsym == '0' ~ as.numeric(lethsym),
      lethsym %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    lethcomp = if_else(lethcomp == '1', TRUE, FALSE),
    lethday = case_when(
      lethday == 99999 ~ NA_real_,
      is.numeric(lethday) ~ as.numeric(lethday),
      TRUE ~ NA_real_
    ),
    bechcomp = if_else(bechcomp == '1', TRUE, FALSE),
    moabsym = case_when(
      moabsym == '1' ~ as.numeric(moabsym),
      moabsym == '0' ~ as.numeric(moabsym),
      moabsym %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    moabcomp = if_else(moabcomp == '1', TRUE, FALSE),
    moabday = case_when(
      moabday == 99999 ~ NA_real_,
      is.numeric(moabday) ~ as.numeric(moabday),
      TRUE ~ NA_real_
    ),
    seabsym = case_when(
      seabsym == '1' ~ as.numeric(seabsym),
      seabsym == '0' ~ as.numeric(seabsym),
      seabsym %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    seabcomp = if_else(seabcomp == '1', TRUE, FALSE),
    seabday = case_when(
      seabday == 99999 ~ NA_real_,
      is.numeric(seabday) ~ as.numeric(seabday),
      TRUE ~ NA_real_
    ),
    cranpsym = case_when(
      cranpsym == '1' ~ as.numeric(cranpsym),
      cranpsym == '0' ~ as.numeric(cranpsym),
      cranpsym %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    cranpcomp = if_else(cranpcomp == '1', TRUE, FALSE),
    cranpday = case_when(
      cranpday == 99999 ~ NA_real_,
      is.numeric(cranpday) ~ as.numeric(cranpday),
      TRUE ~ NA_real_
    ),
    seizucomp = if_else(seizucomp == '1', TRUE, FALSE),
    seipattern = case_when(
      site == 'Jakarta' & seipattern == '1' ~ 0,
      site == 'Jakarta' & seipattern == '2' ~ 1,
      site == 'Bandung' & seipattern == '0' ~ 0,
      site == 'Bandung' & seipattern == '1' ~ 1,
      seipattern %in% c('8', '9') ~ 2,
    ),
    seiwitms = if_else(seiwitms == '1', TRUE, FALSE),
    seizufre = case_when(
      seizufre == '0' ~ 0,
      seizufre == '1' ~ 1,
      seizufre == '2' ~ 2,
      seizufre %in% c('8', '9') ~ 3,
      TRUE ~ NA_real_
    ),
    othcomp = if_else(othcomp == '1', TRUE, FALSE),
    othday = case_when(
      othday == 99999 ~ NA_real_,
      is.numeric(othday) ~ as.numeric(othday),
      TRUE ~ NA_real_
    ),
    weightlost = case_when(
      weightlost == '1' ~ as.numeric(weightlost),
      weightlost == '0' ~ as.numeric(weightlost),
      weightlost %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    nsweat = case_when(
      nsweat == '1' ~ as.numeric(nsweat),
      nsweat == '0' ~ as.numeric(nsweat),
      nsweat %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    bcg = case_when(
      bcg == '1' ~ as.numeric(bcg),
      bcg == '0' ~ as.numeric(bcg),
      bcg %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    treatedtb = case_when(
      treatedtb == '1' ~ as.numeric(treatedtb),
      treatedtb == '0' ~ as.numeric(treatedtb),
      treatedtb %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    pretb = case_when(
      pretb == '1' ~ as.numeric(pretb),
      pretb == '0' ~ as.numeric(pretb),
      pretb %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    tbrecent = case_when(
      site == 'Jakarta' & tbrecent == '1' ~ 0,
      site == 'Jakarta' & tbrecent == '2' ~ 1,
      site == 'Jakarta' & tbrecent == '3' ~ 2,
      site == 'Jakarta' & tbrecent == '4' ~ 3,
      site == 'Bandung' & tbrecent == '0' ~ 0,
      site == 'Bandung' & tbrecent == '1' ~ 1,
      site == 'Bandung' & tbrecent == '2' ~ 2,
      site == 'Bandung' & tbrecent == '3' ~ 3,
      tbrecent %in% c('8', '9') ~ 4,
      TRUE ~ NA_real_
    ),
    tbsttrec = case_when(
      site == 'Jakarta' & tbsttrec == '1' ~ 0,
      site == 'Jakarta' & tbsttrec == '2' ~ 1,
      site == 'Jakarta' & tbsttrec == '3' ~ 2,
      site == 'Bandung' & tbsttrec == '0' ~ 0,
      site == 'Bandung' & tbsttrec == '1' ~ 1,
      site == 'Bandung' & tbsttrec == '2' ~ 2,
      TRUE ~ NA_real_
    ),
    tbsttpul = if_else(tbsttpul == '1', TRUE, FALSE),
    tbsttmen = if_else(tbsttmen == '1', TRUE, FALSE),
    tbsttoth = if_else(tbsttoth == '1', TRUE, FALSE),
    tblatent = case_when(
      tblatent == '1' ~ as.numeric(tblatent),
      tblatent == '0' ~ as.numeric(tblatent),
      tblatent %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    tbipt = case_when(
      tbipt == '1' ~ as.numeric(tbipt),
      tbipt == '0' ~ as.numeric(tbipt),
      tbipt %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    precns = case_when(
      precns == '1' ~ as.numeric(precns),
      precns == '0' ~ as.numeric(precns),
      precns %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    cnsmen = if_else(cnsmen == '1', TRUE, FALSE),
    cnsenc = if_else(cnsenc == '1', TRUE, FALSE),
    cnsbra = if_else(cnsbra == '1', TRUE, FALSE),
    cnsmye = if_else(cnsmye == '1', TRUE, FALSE),
    cnsmtub = if_else(cnsmtub == '1', TRUE, FALSE),
    cnstoxo = if_else(cnstoxo == '1', TRUE, FALSE),
    cnscryp = if_else(cnscryp == '1', TRUE, FALSE),
    cnsepi = case_when(
      cnsepi == 99999 ~ NA_real_,
      is.numeric(cnsepi) ~ as.numeric(cnsepi),
      TRUE ~ NA_real_
    ),
    diabetes = case_when(
      diabetes == '1' ~ as.numeric(diabetes),
      diabetes == '0' ~ as.numeric(diabetes),
      diabetes %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    diatherapy = case_when(
      diatherapy == '0' ~ 0,
      diatherapy == '1' ~ 1,
      diatherapy == '2' & site == 'Bandung' ~ 2,
      diatherapy == '3' & site == 'Jakarta' ~ 2,
      diatherapy == '3' & site == 'Bandung' ~ 3,
      diatherapy == '2' & site == 'Jakarta' ~ 3,
      diatherapy %in% c('8', '9') ~ 4,
      TRUE ~ NA_real_
    ),
    corticocurt = case_when(
      corticocurt == '1' ~ as.numeric(corticocurt),
      corticocurt == '0' ~ as.numeric(corticocurt),
      corticocurt %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    piein30 = if_else(piein30 == '1', TRUE, FALSE),
    pieanimal = case_when(
      pieanimal == '1' ~ as.numeric(pieanimal),
      pieanimal == '0' ~ as.numeric(pieanimal),
      pieanimal %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    piefreshwt = case_when(
      piefreshwt == '1' ~ as.numeric(piefreshwt),
      piefreshwt == '0' ~ as.numeric(piefreshwt),
      piefreshwt %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    hissmoking = case_when(
      site == 'Jakarta' & hissmoking == '1' ~ 0,  
      site == 'Jakarta' & hissmoking == '2' ~ 1,  
      site == 'Jakarta' & hissmoking == '3' ~ 2, 
      site == 'Bandung' & hissmoking == '0' ~ 0,  
      site == 'Bandung' & hissmoking == '1' ~ 1,  
      site == 'Bandung' & hissmoking == '2' ~ 2, 
      TRUE ~ NA_real_
    ),
    loctemp = case_when(
      site == 'Jakarta' & loctemp == '1' ~ 0,  
      site == 'Jakarta' & loctemp == '2' ~ 1,  
      site == 'Jakarta' & loctemp == '3' ~ 2, 
      site == 'Bandung' & loctemp == '0' ~ 0,  
      site == 'Bandung' & loctemp == '1' ~ 1,  
      site == 'Bandung' & loctemp == '2' ~ 2, 
      TRUE ~ NA_real_
    ),
    respiratory = if_else(respiratory == 99999 | is.na(respiratory),
                          NA_real_, as.numeric(respiratory)),
    oxysatu = if_else(oxysatu == 99999 | is.na(oxysatu),
                      NA_real_, as.numeric(oxysatu)),
    weight = if_else(weight == 99999 | is.na(weight),
                     NA_real_, as.numeric(weight)),
    weightmth = case_when(
       site == 'Jakarta' & weightmth == '1' ~ 0,
       site == 'Jakarta' & weightmth == '2' ~ 1,
       site == 'Bandung' ~ as.numeric(weightmth),
       TRUE ~ NA_real_
    ),
    armcir = if_else(armcir == 99999 | is.na(armcir),
                     NA_real_, as.numeric(armcir)),
    height = if_else(height == 99999 | is.na(height),
                     NA_real_, as.numeric(height)),
    heightmth = case_when(
      site == 'Jakarta' & heightmth == '1' ~ 0,
      site == 'Jakarta' & heightmth == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(heightmth),
      TRUE ~ NA_real_
    ),
    eyesc = if_else(eyesc >= 4, 4, as.numeric(eyesc)),
    motoric = if_else(motoric >= 6, 6, as.numeric(motoric)),
    verbal = if_else(verbal >= 5, 5, as.numeric(verbal)),
    nerve3rd = case_when(
      nerve3rd == '1' ~ as.numeric(nerve3rd),
      nerve3rd == '0' ~ as.numeric(nerve3rd),
      nerve3rd %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    nerve4th = case_when(
      nerve4th == '1' ~ as.numeric(nerve4th),
      nerve4th == '0' ~ as.numeric(nerve4th),
      nerve4th %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    nerve6th = case_when(
      nerve6th == '1' ~ as.numeric(nerve6th),
      nerve6th == '0' ~ as.numeric(nerve6th),
      nerve6th %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    nerve7th = case_when(
      nerve7th == '1' ~ as.numeric(nerve7th),
      nerve7th == '0' ~ as.numeric(nerve7th),
      nerve7th %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    nerve12th = case_when(
      nerve12th == '1' ~ as.numeric(nerve12th),
      nerve12th == '0' ~ as.numeric(nerve12th),
      nerve12th %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    pupisz = case_when(
      site == 'Jakarta' & pupisz == '1' ~ 0,
      site == 'Jakarta' & pupisz == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(pupisz),
      TRUE ~ NA_real_
    ),
    pupiref = case_when(
      site == 'Jakarta' & pupiref == '1' ~ 0,
      site == 'Jakarta' & pupiref == '2' ~ 1,
      site == 'Jakarta' & pupiref == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(pupiref),
      pupiref == '8' ~ 3,
      TRUE ~ NA_real_
    ),
    urinary = case_when(
      urinary == '1' ~ as.numeric(urinary),
      urinary == '0' ~ as.numeric(urinary),
      urinary %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    gasbleed = case_when(
      gasbleed == '1' ~ as.numeric(gasbleed),
      gasbleed == '0' ~ as.numeric(gasbleed),
      gasbleed %in% c('8', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    inidiamen = if_else(inidiamen == 1, TRUE, FALSE),
    inidiaence = if_else(inidiaence == 1, TRUE, FALSE),
    inidiamye = if_else(inidiamye == 1, TRUE, FALSE),
    inidiabrain = if_else(inidiabrain == 1, TRUE, FALSE),
    inidiaenc = if_else(inidiaenc == 1, TRUE, FALSE),
    suetibac = if_else(suetibac == 1, TRUE, FALSE),
    suetiviral = if_else(suetiviral == 1, TRUE, FALSE),
    suetitoxo = if_else(suetitoxo == 1, TRUE, FALSE),
    suetiauto = if_else(suetiauto == 1, TRUE, FALSE),
    sueticryp = if_else(sueticryp == 1, TRUE, FALSE),
    suetimtube = if_else(suetimtube == 1, TRUE, FALSE),
    suetiunk = if_else(suetiunk == 1, TRUE, FALSE),
    suetiunk = if_else(suetiunk == 1, TRUE, FALSE),
    cnsinfec = case_when(
      site == 'Jakarta' & cnsinfec == '1' ~ 0,
      site == 'Jakarta' & cnsinfec == '2' ~ 1,
      site == 'Jakarta' & cnsinfec == '3' ~ 2,
      site == 'Jakarta' & cnsinfec == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(cnsinfec),
      TRUE ~ NA_real_
    ),
    othonset = if_else(othonset == 99999 | is.na(othonset),
                       NA_real_, as.numeric(othonset)),
    onsetstt = case_when(
      site == 'Jakarta' & onsetstt == '1' ~ 0,
      site == 'Jakarta' & onsetstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(onsetstt),
      TRUE ~ NA_real_
    ),
    hivresult = case_when(
      hivresult == '1' ~ as.numeric(hivresult),
      hivresult == '0' ~ as.numeric(hivresult),
      hivresult %in% c('2', '9') ~ 2,
      TRUE ~ NA_real_
    ),
    xray = case_when(
      site == 'Jakarta' & xray == '1' ~ 0,
      site == 'Jakarta' & xray == '2' ~ 1,
      site == 'Jakarta' & xray == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(xray),
      TRUE ~ NA_real_
    ),
    tbdrug = case_when(
      site == 'Jakarta' & tbdrug == '1' ~ 0,
      site == 'Jakarta' & tbdrug == '2' ~ 1,
      site == 'Bandung'  ~ as.numeric(tbdrug),
      TRUE ~ NA_real_
    ),
    tbdrugdtc = ymd(tbdrugdtc),
    tbdrugstt = case_when(
      site == 'Jakarta' & tbdrugstt == '1' ~ 0,
      site == 'Jakarta' & tbdrugstt == '2' ~ 1,
      site == 'Bandung'  ~ as.numeric(tbdrugstt),
      TRUE ~ NA_real_
    ),
    levof = case_when(
      site == 'Jakarta' & levof == '1' ~ 0,
      site == 'Jakarta' & levof == '2' ~ 1,
      site == 'Bandung'  ~ as.numeric(levof),
      TRUE ~ NA_real_
    ),
    levofdtc = ymd(levofdtc),
    levofstt = case_when(
      site == 'Jakarta' & levofstt == '1' ~ 0,
      site == 'Jakarta' & levofstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(levofstt),
      TRUE ~ NA_real_
    ),
    moxif = case_when(
      site == 'Jakarta' & moxif == '1' ~ 0,
      site == 'Jakarta' & moxif == '2' ~ 1,
      site == 'Bandung'  ~ as.numeric(moxif),
      TRUE ~ NA_real_
    ),
    moxifdtc = ymd(moxifdtc),
    moxifstt = case_when(
      site == 'Jakarta' & moxifstt == '1' ~ 0,
      site == 'Jakarta' & moxifstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(moxifstt),
      TRUE ~ NA_real_
    ),
    cotrimo = case_when(
      site == 'Jakarta' & cotrimo == '1' ~ 0,
      site == 'Jakarta' & cotrimo == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(cotrimo),
      TRUE ~ NA_real_
    ),
    cotrimodtc = ymd(cotrimodtc),
    cotrimostt = case_when(
      site == 'Jakarta' & cotrimostt == '1' ~ 0,
      site == 'Jakarta' & cotrimostt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(cotrimostt),
      TRUE ~ NA_real_
    ),
    metroni = case_when(
      site == 'Jakarta' & metroni == '1' ~ 0,
      site == 'Jakarta' & metroni == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(metroni),
      TRUE ~ NA_real_
    ),
    metronidtc = ymd(metronidtc),
    metronistt = case_when(
      site == 'Jakarta' & metronistt == '1' ~ 0,
      site == 'Jakarta' & metronistt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(metronistt),
      TRUE ~ NA_real_
    ),
    pyrime = case_when(
      site == 'Jakarta' & pyrime == '1' ~ 0,
      site == 'Jakarta' & pyrime == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(pyrime),
      TRUE ~ NA_real_
    ),
    pyrimedtc = ymd(pyrimedtc),
    pyrimestt = case_when(
      site == 'Jakarta' & pyrimestt == '1' ~ 0,
      site == 'Jakarta' & pyrimestt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(pyrimestt),
      TRUE ~ NA_real_
    ),
    
    clinda = case_when(
      site == 'Jakarta' & clinda == '1' ~ 0,
      site == 'Jakarta' & clinda == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(clinda),
      TRUE ~ NA_real_
    ),
    
    ### This section may not be reproducible in additional dataset, check again!
    clindadtc = clindadtc0,
    clindastt0 = clindastt0,
    ###
    
    fluco = case_when(
      site == 'Jakarta' & fluco == '1' ~ 0,
      site == 'Jakarta' & fluco == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(fluco),
      TRUE ~ NA_real_
    ),
    flucodtc = ymd(flucodtc),
    flucostt = case_when(
      site == 'Jakarta' & flucostt == '1' ~ 0,
      site == 'Jakarta' & flucostt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(flucostt),
      TRUE ~ NA_real_
    ), 
    ampho = case_when(
      site == 'Jakarta' & ampho == '1' ~ 0,
      site == 'Jakarta' & ampho == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(ampho),
      TRUE ~ NA_real_
    ),
    amphodtc = ymd(amphodtc),
    amphostt = case_when(
      site == 'Jakarta' & amphostt == '1' ~ 0,
      site == 'Jakarta' & amphostt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(amphostt),
      TRUE ~ NA_real_
    ), 
    ceftria = case_when(
      site == 'Jakarta' & ceftria == '1' ~ 0,
      site == 'Jakarta' & ceftria == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(ceftria),
      TRUE ~ NA_real_
    ),
    ceftriadtc = ymd(ceftriadtc),
    ceftriastt = case_when(
      site == 'Jakarta' & ceftriastt == '1' ~ 0,
      site == 'Jakarta' & ceftriastt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(ceftriastt),
      TRUE ~ NA_real_
    ), 
    merope = case_when(
      site == 'Jakarta' & merope == '1' ~ 0,
      site == 'Jakarta' & merope == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(merope),
      TRUE ~ NA_real_
    ),
    meropedtc = ymd(meropedtc),
    meropestt = case_when(
      site == 'Jakarta' & meropestt == '1' ~ 0,
      site == 'Jakarta' & meropestt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(meropestt),
      TRUE ~ NA_real_
    ), 
    acyclo = case_when(
      site == 'Jakarta' & acyclo == '1' ~ 0,
      site == 'Jakarta' & acyclo == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(acyclo),
      TRUE ~ NA_real_
    ),
    acyclodtc = ymd(acyclodtc),
    acyclostt = case_when(
      site == 'Jakarta' & acyclostt == '1' ~ 0,
      site == 'Jakarta' & acyclostt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(acyclostt),
      TRUE ~ NA_real_
    ), 
    valgan = case_when(
      site == 'Jakarta' & valgan == '1' ~ 0,
      site == 'Jakarta' & valgan == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(valgan),
      TRUE ~ NA_real_
    ),
    valgandtc = ymd(valgandtc),
    valganstt = case_when(
      site == 'Jakarta' & valganstt == '1' ~ 0,
      site == 'Jakarta' & valganstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(valganstt),
      TRUE ~ NA_real_
    ), 
    dexame = case_when(
      site == 'Jakarta' & dexame == '1' ~ 0,
      site == 'Jakarta' & dexame == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(dexame),
      TRUE ~ NA_real_
    ),
    dexamedtc = ymd(dexamedtc),
    dexamestt = case_when(
      site == 'Jakarta' & dexamestt == '1' ~ 0,
      site == 'Jakarta' & dexamestt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(dexamestt),
      TRUE ~ NA_real_
    ), 
    methyl = case_when(
      site == 'Jakarta' & methyl == '1' ~ 0,
      site == 'Jakarta' & methyl == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(methyl),
      TRUE ~ NA_real_
    ),
    methyldtc = ymd(methyldtc),
    methylstt = case_when(
      site == 'Jakarta' & methylstt == '1' ~ 0,
      site == 'Jakarta' & methylstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(methylstt),
      TRUE ~ NA_real_
    ), 
    mannitol = case_when(
      site == 'Jakarta' & mannitol == '1' ~ 0,
      site == 'Jakarta' & mannitol == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(mannitol),
      TRUE ~ NA_real_
    ),
    mannitoldtc = ymd(mannitoldtc),
    mannitolstt = case_when(
      site == 'Jakarta' & mannitolstt == '1' ~ 0,
      site == 'Jakarta' & mannitolstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(mannitolstt),
      TRUE ~ NA_real_
    ), 
    furose = case_when(
      site == 'Jakarta' & furose == '1' ~ 0,
      site == 'Jakarta' & furose == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(furose),
      TRUE ~ NA_real_
    ),
    furosedtc = ymd(furosedtc),
    furosestt = case_when(
      site == 'Jakarta' & furosestt == '1' ~ 0,
      site == 'Jakarta' & furosestt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(furosestt),
      TRUE ~ NA_real_
    ), 
    valproic = case_when(
      site == 'Jakarta' & valproic == '1' ~ 0,
      site == 'Jakarta' & valproic == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(valproic),
      TRUE ~ NA_real_
    ),
    valproicdtc = ymd(valproicdtc),
    valproicstt = case_when(
      site == 'Jakarta' & valproicstt == '1' ~ 0,
      site == 'Jakarta' & valproicstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(valproicstt),
      TRUE ~ NA_real_
    ), 
    topira = case_when(
      site == 'Jakarta' & topira == '1' ~ 0,
      site == 'Jakarta' & topira == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(topira),
      TRUE ~ NA_real_
    ),
    topiradtc = ymd(topiradtc),
    topirastt = case_when(
      site == 'Jakarta' & topirastt == '1' ~ 0,
      site == 'Jakarta' & topirastt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(topirastt),
      TRUE ~ NA_real_
    ), 
    pheny = case_when(
      site == 'Jakarta' & pheny == '1' ~ 0,
      site == 'Jakarta' & pheny == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(pheny),
      TRUE ~ NA_real_
    ),
    phenydtc = ymd(phenydtc),
    phenystt = case_when(
      site == 'Jakarta' & phenystt == '1' ~ 0,
      site == 'Jakarta' & phenystt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(phenystt),
      TRUE ~ NA_real_
    ), 
    levitira = case_when(
      site == 'Jakarta' & levitira == '1' ~ 0,
      site == 'Jakarta' & levitira == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(levitira),
      TRUE ~ NA_real_
    ),
    levitiradtc = ymd(levitiradtc),
    levitirastt = case_when(
      site == 'Jakarta' & levitirastt == '1' ~ 0,
      site == 'Jakarta' & levitirastt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(levitirastt),
      TRUE ~ NA_real_
    ), 
    ranppi = case_when(
      site == 'Jakarta' & ranppi == '1' ~ 0,
      site == 'Jakarta' & ranppi == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(ranppi),
      TRUE ~ NA_real_
    ),
    ranppidtc = ymd(ranppidtc),
    ranppistt = case_when(
      site == 'Jakarta' & ranppistt == '1' ~ 0,
      site == 'Jakarta' & ranppistt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(ranppistt),
      TRUE ~ NA_real_
    ), 
    art = case_when(
      site == 'Jakarta' & art == '1' ~ 0,
      site == 'Jakarta' & art == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(art),
      TRUE ~ NA_real_
    ),
    artdtc = ymd(artdtc),
    artstt = case_when(
      site == 'Jakarta' & artstt == '1' ~ 0,
      site == 'Jakarta' & artstt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(artstt),
      TRUE ~ NA_real_
    ), 
    oth1 = case_when(
      site == 'Jakarta' & oth1 == '1' ~ 0,
      site == 'Jakarta' & oth1 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth1),
      TRUE ~ NA_real_
    ),
    oth1dtc = ymd(oth1dtc),
    oth1stt = case_when(
      site == 'Jakarta' & oth1stt == '1' ~ 0,
      site == 'Jakarta' & oth1stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth1stt),
      TRUE ~ NA_real_
    ), 
    oth2 = case_when(
      site == 'Jakarta' & oth2 == '1' ~ 0,
      site == 'Jakarta' & oth2 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth2),
      TRUE ~ NA_real_
    ),
    oth2dtc = ymd(oth2dtc),
    oth2stt = case_when(
      site == 'Jakarta' & oth2stt == '1' ~ 0,
      site == 'Jakarta' & oth2stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth2stt),
      TRUE ~ NA_real_
    ), 
    
    oth3 = case_when(
      site == 'Jakarta' & oth3 == '1' ~ 0,
      site == 'Jakarta' & oth3 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth3),
      TRUE ~ NA_real_
    ),
    oth3dtc = ymd(oth3dtc),
    oth3stt = case_when(
      site == 'Jakarta' & oth3stt == '1' ~ 0,
      site == 'Jakarta' & oth3stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth3stt),
      TRUE ~ NA_real_
    ), 
    oth4 = case_when(
      site == 'Jakarta' & oth4 == '1' ~ 0,
      site == 'Jakarta' & oth4 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth4),
      TRUE ~ NA_real_
    ),
    oth4dtc = ymd(oth4dtc),
    oth4stt = case_when(
      site == 'Jakarta' & oth4stt == '1' ~ 0,
      site == 'Jakarta' & oth4stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth4stt),
      TRUE ~ NA_real_
    ), 
    oth5 = case_when(
      site == 'Jakarta' & oth5 == '1' ~ 0,
      site == 'Jakarta' & oth5 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth5),
      TRUE ~ NA_real_
    ),
    oth5dtc = ymd(oth5dtc),
    oth5stt = case_when(
      site == 'Jakarta' & oth5stt == '1' ~ 0,
      site == 'Jakarta' & oth5stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth5stt),
      TRUE ~ NA_real_
    ), 
    oth6 = case_when(
      site == 'Jakarta' & oth6 == '1' ~ 0,
      site == 'Jakarta' & oth6 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth6),
      TRUE ~ NA_real_
    ),
    oth6dtc = ymd(oth6dtc),
    oth6stt = case_when(
      site == 'Jakarta' & oth6stt == '1' ~ 0,
      site == 'Jakarta' & oth6stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth6stt),
      TRUE ~ NA_real_
    ),
    oth7 = case_when(
      site == 'Jakarta' & oth7 == '1' ~ 0,
      site == 'Jakarta' & oth7 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth7),
      TRUE ~ NA_real_
    ),
    oth7dtc = ymd(oth7dtc),
    oth7stt = case_when(
      site == 'Jakarta' & oth7stt == '1' ~ 0,
      site == 'Jakarta' & oth7stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth7stt),
      TRUE ~ NA_real_
    ),
    oth8 = case_when(
      site == 'Jakarta' & oth8 == '1' ~ 0,
      site == 'Jakarta' & oth8 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth8),
      TRUE ~ NA_real_
    ),
    oth8dtc = ymd(oth8dtc),
    oth8stt = case_when(
      site == 'Jakarta' & oth8stt == '1' ~ 0,
      site == 'Jakarta' & oth8stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth8stt),
      TRUE ~ NA_real_
    ),
    oth9 = case_when(
      site == 'Jakarta' & oth9 == '1' ~ 0,
      site == 'Jakarta' & oth9 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth9),
      TRUE ~ NA_real_
    ),
    oth9dtc = ymd(oth9dtc),
    oth9stt = case_when(
      site == 'Jakarta' & oth9stt == '1' ~ 0,
      site == 'Jakarta' & oth9stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth9stt),
      TRUE ~ NA_real_
    ),
    oth10 = case_when(
      site == 'Jakarta' & oth10 == '1' ~ 0,
      site == 'Jakarta' & oth10 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth10),
      TRUE ~ NA_real_
    ),
    oth10dtc = ymd(oth10dtc),
    oth10stt = case_when(
      site == 'Jakarta' & oth10stt == '1' ~ 0,
      site == 'Jakarta' & oth10stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth10stt),
      TRUE ~ NA_real_
    ),
    oth11 = case_when(
      site == 'Jakarta' & oth11 == '1' ~ 0,
      site == 'Jakarta' & oth11 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth11),
      TRUE ~ NA_real_
    ),
    oth11dtc = ymd(oth11dtc),
    oth11stt = case_when(
      site == 'Jakarta' & oth11stt == '1' ~ 0,
      site == 'Jakarta' & oth11stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth11stt),
      TRUE ~ NA_real_
    ),
    oth12 = case_when(
      site == 'Jakarta' & oth12 == '1' ~ 0,
      site == 'Jakarta' & oth12 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth12),
      TRUE ~ NA_real_
    ),
    oth12dtc = ymd(oth12dtc),
    oth12stt = case_when(
      site == 'Jakarta' & oth12stt == '1' ~ 0,
      site == 'Jakarta' & oth12stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth12stt),
      TRUE ~ NA_real_
    ),
    oth13 = case_when(
      site == 'Jakarta' & oth13 == '1' ~ 0,
      site == 'Jakarta' & oth13 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth13),
      TRUE ~ NA_real_
    ),
    oth13dtc = ymd(oth13dtc),
    oth13stt = case_when(
      site == 'Jakarta' & oth13stt == '1' ~ 0,
      site == 'Jakarta' & oth13stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth13stt),
      TRUE ~ NA_real_
    ),
    oth14 = case_when(
      site == 'Jakarta' & oth14 == '1' ~ 0,
      site == 'Jakarta' & oth14 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth14),
      TRUE ~ NA_real_
    ),
    oth14dtc = ymd(oth14dtc),
    oth14stt = case_when(
      site == 'Jakarta' & oth14stt == '1' ~ 0,
      site == 'Jakarta' & oth14stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth14stt),
      TRUE ~ NA_real_
    ),
    oth15 = case_when(
      site == 'Jakarta' & oth15 == '1' ~ 0,
      site == 'Jakarta' & oth15 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth15),
      TRUE ~ NA_real_
    ),
    oth15dtc = ymd(oth15dtc),
    oth15stt = case_when(
      site == 'Jakarta' & oth15stt == '1' ~ 0,
      site == 'Jakarta' & oth15stt == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(oth15stt),
      TRUE ~ NA_real_
    ),
    hemodtc = ymd(hemodtc),
    hemond = case_when(
      site == 'Jakarta' & hemond == '0' ~ 0,
      site == 'Jakarta' & hemond == '1' ~ 1,
      site == 'Bandung' & hemond == '1' ~ 1,
      site == 'Bandung' & hemond == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    hemadtc = ymd(hemadtc),
    hemand = case_when(
      site == 'Jakarta' & hemand == '0' ~ 0,
      site == 'Jakarta' & hemand == '1' ~ 1,
      site == 'Bandung' & hemand == '1' ~ 1,
      site == 'Bandung' & hemand == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    wcellcdtc = ymd(wcellcdtc),
    wcellcnd = case_when(
      site == 'Jakarta' & wcellcnd == '0' ~ 0,
      site == 'Jakarta' & wcellcnd == '1' ~ 1,
      site == 'Bandung' & wcellcnd == '1' ~ 1,
      site == 'Bandung' & wcellcnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    neudtc = ymd(neudtc),
    neund = case_when(
      site == 'Jakarta' & neund == '0' ~ 0,
      site == 'Jakarta' & neund == '1' ~ 1,
      site == 'Bandung' & neund == '1' ~ 1,
      site == 'Bandung' & neund == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    monodtc = ymd(monodtc),
    monond = case_when(
      site == 'Jakarta' & monond == '0' ~ 0,
      site == 'Jakarta' & monond == '1' ~ 1,
      site == 'Bandung' & monond == '1' ~ 1,
      site == 'Bandung' & monond == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    lympdtc = ymd(lympdtc),
    lympnd = case_when(
      site == 'Jakarta' & lympnd == '0' ~ 0,
      site == 'Jakarta' & lympnd == '1' ~ 1,
      site == 'Bandung' & lympnd == '1' ~ 1,
      site == 'Bandung' & lympnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    eosidtc = ymd(eosidtc),
    eosind = case_when(
      site == 'Jakarta' & eosind == '0' ~ 0,
      site == 'Jakarta' & eosind == '1' ~ 1,
      site == 'Bandung' & eosind == '1' ~ 1,
      site == 'Bandung' & eosind == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    platedtc = ymd(platedtc),
    platend = case_when(
      site == 'Jakarta' & platend == '0' ~ 0,
      site == 'Jakarta' & platend == '1' ~ 1,
      site == 'Bandung' & platend == '1' ~ 1,
      site == 'Bandung' & platend == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    altdtc = ymd(altdtc),
    altnd = case_when(
      site == 'Jakarta' & altnd == '0' ~ 0,
      site == 'Jakarta' & altnd == '1' ~ 1,
      site == 'Bandung' & altnd == '1' ~ 1,
      site == 'Bandung' & altnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    creatdtc = ymd(creatdtc),
    creatnd = case_when(
      site == 'Jakarta' & creatnd == '0' ~ 0,
      site == 'Jakarta' & creatnd == '1' ~ 1,
      site == 'Bandung' & creatnd == '1' ~ 1,
      site == 'Bandung' & creatnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    sodiumdtc = ymd(sodiumdtc),
    sodiumnd = case_when(
      site == 'Jakarta' & sodiumnd == '0' ~ 0,
      site == 'Jakarta' & sodiumnd == '1' ~ 1,
      site == 'Bandung' & sodiumnd == '1' ~ 1,
      site == 'Bandung' & sodiumnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    hivdtc = case_when(
      site == 'Jakarta' & hivdtc == '##/##/####' ~ NA_Date_,
      site == 'Jakarta' ~ dmy(hivdtc),
      site == 'Bandung' ~ ymd(hivdtc),
      TRUE ~ NA_Date_
    ),
    hbadtc = ymd(hbadtc),
    hband = case_when(
      site == 'Jakarta' & hband == '0' ~ 0,
      site == 'Jakarta' & hband == '1' ~ 1,
      site == 'Bandung' & hband == '1' ~ 1,
      site == 'Bandung' & hband == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    bilirudtc = ymd(bilirudtc),
    bilirund = case_when(
      site == 'Jakarta' & bilirund == '0' ~ 0,
      site == 'Jakarta' & bilirund == '1' ~ 1,
      site == 'Bandung' & bilirund == '1' ~ 1,
      site == 'Bandung' & bilirund == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    hbsagvalue =  if_else(hbsagvalue == 2 | hbsagvalue == 9,
                          2, as.numeric(hbsagvalue)),
    hcvdtc = ymd(hcvdtc),
    hcvvalue =  if_else(hcvvalue == 2 | hcvvalue == 9,
                        2, as.numeric(hcvvalue)),
    crpdtc = ymd(crpdtc),
    crpnd = case_when(
      site == 'Jakarta' & crpnd == '0' ~ 0,
      site == 'Jakarta' & crpnd == '1' ~ 1,
      site == 'Bandung' & crpnd == '1' ~ 1,
      site == 'Bandung' & crpnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    procaldtc = ymd(procaldtc),
    procalnd = case_when(
      site == 'Jakarta' & procalnd == '0' ~ 0,
      site == 'Jakarta' & procalnd == '1' ~ 1,
      site == 'Bandung' & procalnd == '1' ~ 1,
      site == 'Bandung' & procalnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    cd4nd = case_when(
      site == 'Jakarta' & cd4nd == '0' ~ 0,
      site == 'Jakarta' & cd4nd == '1' ~ 1,
      site == 'Bandung' & cd4nd == '1' ~ 1,
      site == 'Bandung' & cd4nd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    hivvldtc = ymd(hivvldtc),
    hivvlnd = case_when(
      site == 'Jakarta' & hivvlnd == '0' ~ 0,
      site == 'Jakarta' & hivvlnd == '1' ~ 1,
      site == 'Bandung' & hivvlnd == '1' ~ 1,
      site == 'Bandung' & hivvlnd == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    antiiggdtc = ymd(antiiggdtc),
    # `antiiggvalue` empty column
    vdrldtc = ymd(vdrldtc),
    vdrlvalue = if_else(vdrlvalue == 2 | vdrlvalue == 9,
                        2, as.numeric(vdrlvalue)),
    tphadtc = ymd(tphadtc),
    tphavalue = if_else(tphavalue == 2 | tphavalue == 9,
                        2, as.numeric(tphavalue)),
    nmdardtc = ymd(nmdardtc),
    nmdarvalue = if_else(nmdarvalue == 2 | nmdarvalue == 9,
                         2, as.numeric(nmdarvalue)),
    fujilamdtc = ymd(fujilamdtc),
    fujilamvalue = if_else(fujilamvalue == 2 | fujilamvalue == 9,
                           2, as.numeric(fujilamvalue)),
    aleredtc = ymd(aleredtc),
    alerevalue = if_else(alerevalue == 2 | alerevalue == 9,
                         2, as.numeric(alerevalue)),
    othrs1dtc = ymd(othrs1dtc),
    othrs2dtc = ymd(othrs2dtc),
    hivmonth = if_else(hivmonth == 99999 | is.na(hivmonth),
                       NA_real_, as.numeric(hivmonth)),
    # `hivyear` unclear years for Bandung
    # `hivunk` unclear information on categories
    arths = case_when(
      site == 'Jakarta' & arths == '1' ~ 0,
      site == 'Jakarta' & arths == '2' ~ 1,
      site == 'Jakarta' & arths == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(arths),
      arths %in% c('8', '9') ~ 3,
      TRUE ~ NA_real_
    ),
    cd4count = if_else(cd4count == '99999' | is.na(cd4count),
                       NA_real_, as.numeric(cd4count)),
    cd4stt = case_when(
      site == 'Jakarta' & cd4stt == '1' ~ 0,
      site == 'Bandung' & cd4stt == '0' ~ 0,
      cd4stt %in% c('8', '9') ~ 1,
      TRUE ~ NA_real_
    ),
    cd4dtc2 = case_when(
      site == 'Jakarta' & cd4dtc2 == '##/##/####' ~ NA_Date_,
      site == 'Jakarta' ~ dmy(cd4dtc2),
      site == 'Bandung' ~ ymd(cd4dtc2),
      TRUE ~ NA_Date_
    ),
    viloadstt = case_when(
      site == 'Jakarta' & viloadstt == '1' ~ 0,
      site == 'Bandung' & viloadstt == '0' ~ 0,
      viloadstt %in% c('8', '9') ~ 1,
      TRUE ~ NA_real_
    ),
    viload = as.numeric(viload),
    viloaddtc = case_when(
      site == 'Jakarta' & viloaddtc == '##/##/####' ~ NA_Date_,
      site == 'Jakarta' ~ dmy(viloaddtc),
      site == 'Bandung' ~ ymd(viloaddtc),
      TRUE ~ NA_Date_
    ),
    hivmususstt = case_when(
      site == 'Jakarta' & hivmususstt == '1' ~ 0,
      site == 'Bandung' & hivmususstt == '0' ~ 0,
      hivmususstt %in% c('8', '9') ~ 1,
      TRUE ~ NA_real_
    ),
    cotripro = case_when(
      cotripro %in% c('8', '9') ~ 3,
      site == 'Jakarta' & cotripro == '3' ~ 0,
      site == 'Jakarta' & cotripro == '1' ~ 1,
      site == 'Jakarta' & cotripro == '2' ~ 2,
      site == 'Bandung' ~ as.numeric(cotripro),
      TRUE ~ NA_real_
    ),
    sampledtc1 = ymd(sampledtc1),
    sampledtc2 = ymd(sampledtc2),
    sampletime1 = case_when(
      site == 'Jakarta' ~ as.character(sampletime1),
      site == 'Bandung' ~ str_sub(sampletime1, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    sampletime1 = hms(sampletime1),
    sampletime2 = case_when(
      site == 'Jakarta' ~ as.character(sampletime2),
      site == 'Bandung' ~ str_sub(sampletime2, start = 12, end = -1),
      TRUE ~ NA_character_
    ),
    sampletime2 = hms(sampletime2),
    oppressunm1 = as.numeric(oppressunm1),
    oppressunm2 = as.numeric(oppressunm2),
    appearance1 = case_when(
      site == 'Jakarta' & appearance1 == '1' ~ 1,
      site == 'Jakarta' & appearance1 == '2' ~ 3,
      site == 'Jakarta' & appearance1 == '3' ~ 2,
      site == 'Jakarta' & appearance1 == '4' ~ 0,
      site == 'Bandung' & appearance1 == '1' ~ 1,
      site == 'Bandung' & appearance1 == '2' ~ 2,
      site == 'Bandung' & appearance1 == '3' ~ 3,
      site == 'Bandung' & appearance1 == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    appearance2 = case_when(
      site == 'Jakarta' & appearance2 == '1' ~ 1,
      site == 'Jakarta' & appearance2 == '2' ~ 3,
      site == 'Jakarta' & appearance2 == '3' ~ 2,
      site == 'Jakarta' & appearance2 == '4' ~ 0,
      site == 'Bandung' & appearance2 == '1' ~ 1,
      site == 'Bandung' & appearance2 == '2' ~ 2,
      site == 'Bandung' & appearance2 == '3' ~ 3,
      site == 'Bandung' & appearance2 == '0' ~ 0,
      TRUE ~ NA_real_
    ),
    csf1 = if_else(csf1 == '99999', NA_real_, as.numeric(csf1)),
    csf2 = if_else(csf2 == '99999', NA_real_, as.numeric(csf2)),
    gramstain1 = if_else(gramstain1 %in% c('2', '9'),
                         2, as.numeric(gramstain1)),
    gramstain2 = if_else(gramstain2 %in% c('2', '9'),
                         2, as.numeric(gramstain2)),
    znsmear1 = if_else(znsmear1 %in% c('2', '9'),
                       2, as.numeric(znsmear1)),
    znsmear2 = if_else(znsmear2 %in% c('2', '9'),
                       2, as.numeric(znsmear2)),
    ininksmear1 = if_else(ininksmear1 %in% c('2', '9'),
                          2, as.numeric(ininksmear1)),
    ininksmear2 = if_else(ininksmear2 %in% c('2', '9'),
                          2, as.numeric(ininksmear2)),
    baccult1 = if_else(baccult1 %in% c('2', '9'),
                       2, as.numeric(baccult1)),
    baccult2 = if_else(baccult2 %in% c('2', '9'),
                       2, as.numeric(baccult2)),
    crypcult1 = if_else(crypcult1 %in% c('2', '9'),
                        2, as.numeric(crypcult1)),
    crypcult2 = if_else(crypcult2 %in% c('2', '9'),
                        2, as.numeric(crypcult2)),
    mycocult1 = if_else(mycocult1 %in% c('2', '9'),
                        2, as.numeric(mycocult1)),
    mycocult2 = if_else(mycocult2 %in% c('2', '9'),
                        2, as.numeric(mycocult2)),
    csfnmdar1 = if_else(csfnmdar1 %in% c('2', '9'),
                        2, as.numeric(csfnmdar1)),
    csfnmdar2 = if_else(csfnmdar2 %in% c('2', '9'),
                        2, as.numeric(csfnmdar2)),
    hivviloadnd1 = as.numeric(hivviloadnd1),
    hivviloadnd2 = as.numeric(hivviloadnd2),
    pcrtb1 = if_else(pcrtb1 %in% c('2', '9'),
                     2, as.numeric(pcrtb1)),
    pcrtb2 = if_else(pcrtb2 %in% c('2', '9'),
                     2, as.numeric(pcrtb2)),
    # `gene...`, `pcrcov2...` have incomplete information
    xraydtc = ymd(xraydtc),
    # `xraynd` incomplete information
    
    # `binb1` incomoplete information
    bitype1 = case_when(
      site == 'Jakarta' & bitype1 == '1' ~ 0,
      site == 'Jakarta' & bitype1 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(bitype1),
      TRUE ~ NA_real_
    ),
    bidtc1 = ymd(bidtc1),
    # `bind1` incomplete information
    bicontrast1 = case_when(
      site == 'Jakarta' & bicontrast1 == '1' ~ 1,
      site == 'Jakarta' & bicontrast1 == '2' ~ 0,
      site == 'Bandung' ~ as.numeric(bicontrast1),
      TRUE ~ NA_real_
    ),
    binormal1 = if_else(binormal1 == 1, TRUE, FALSE),
    binormal2 = if_else(binormal2 == 1, TRUE, FALSE),
    binormal3 = if_else(binormal3 == 1, TRUE, FALSE),
    biinfarct1 = if_else(biinfarct1 == 1, TRUE, FALSE),
    biinfarct2 = if_else(biinfarct2 == 1, TRUE, FALSE),
    biinfarct3 = if_else(biinfarct3 == 1, TRUE, FALSE),
    bituber1 = if_else(bituber1 == 1, TRUE, FALSE),
    bituber2 = if_else(bituber2 == 1, TRUE, FALSE),
    bituber3 = if_else(bituber3 == 1, TRUE, FALSE),
    bihydro1 = if_else(bihydro1 == 1, TRUE, FALSE),
    bihydro2 = if_else(bihydro2 == 1, TRUE, FALSE),
    bihydro3 = if_else(bihydro3 == 1, TRUE, FALSE),
    biabscess1 = if_else(biabscess1 == 1, TRUE, FALSE),
    biabscess2 = if_else(biabscess2 == 1, TRUE, FALSE),
    biabscess3 = if_else(biabscess3 == 1, TRUE, FALSE),
    bimenin1 = if_else(bimenin1 == 1, TRUE, FALSE),
    bimenin2 = if_else(bimenin2 == 1, TRUE, FALSE),
    bimenin3 = if_else(bimenin3 == 1, TRUE, FALSE),
    other1 = if_else(other1 == 1, TRUE, FALSE),
    other2 = if_else(other2 == 1, TRUE, FALSE),
    other3 = if_else(other3 == 1, TRUE, FALSE),
    bidtc2 = ymd(bidtc2),
    bidtc3 = ymd(bidtc3),
    
    # `binb2` incomplete information
    bitype2 = case_when(
      site == 'Jakarta' & bitype2 == '1' ~ 0,
      site == 'Jakarta' & bitype2 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(bitype2),
      TRUE ~ NA_real_
    ),
    bicontrast2 = case_when(
      site == 'Jakarta' & bicontrast2 == '1' ~ 1,
      site == 'Jakarta' & bicontrast2 == '2' ~ 0,
      site == 'Bandung' ~ as.numeric(bicontrast2),
      TRUE ~ NA_real_
    ),
    # `binb3` incomplete information
    bitype3 = case_when(
      site == 'Jakarta' & bitype3 == '1' ~ 0,
      site == 'Jakarta' & bitype3 == '2' ~ 1,
      site == 'Bandung' ~ as.numeric(bitype3),
      TRUE ~ NA_real_
    ),
    # `bind3` incomplete information
    bicontrast3 = case_when(
      site == 'Jakarta' & bicontrast3 == '1' ~ 1,
      site == 'Jakarta' & bicontrast3 == '2' ~ 0,
      site == 'Bandung' ~ as.numeric(bicontrast3),
      TRUE ~ NA_real_
    ),
    mridtc = ymd(mridtc),
    # `resmrin`, `mriabscess`, `mrimyelitis`, `mrispcol` incomplete information
    deathdtc = ymd(deathdtc),
    syndmen = if_else(syndmen == 1, TRUE, FALSE),
    syndenc = if_else(syndenc == 1, TRUE, FALSE),
    syndba = if_else(syndba == 1, TRUE, FALSE),
    syndmye = if_else(syndmye == 1, TRUE, FALSE),
    syndence = if_else(syndence == 1, TRUE, FALSE),
    syndnonneu = if_else(syndnonneu == 1, TRUE, FALSE),
    tbmgrade = as.numeric(tbmgrade),
    etipara = if_else(etipara %in% c('2', '9'),
                      2, as.numeric(etipara)),
    etiafb = if_else(etiafb %in% c('2', '9'),
                     2, as.numeric(etiafb)),
    eticult = if_else(eticult %in% c('2', '9'),
                      2, as.numeric(eticult)),
    etixpert = if_else(etixpert %in% c('2', '9'),
                       2, as.numeric(etixpert)),
    # `etiprctb` incomplete information
    etigstain = case_when(
      site == 'Jakarta' & etigstain == '0' ~ 3,
      site == 'Jakarta' & etigstain == '1' ~ 1,
      site == 'Jakarta' & etigstain == '2' ~ 0,
      site == 'Jakarta' & etigstain == '9' ~ 2,
      site == 'Bandung' ~ as.numeric(etigstain),
      TRUE ~ NA_real_
    ),
    etibaccult = if_else(etibaccult %in% c('2', '9'),
                         2, as.numeric(etibaccult)),
    etivencedef = if_else(etivencedef %in% c('0', '5'),
                          0, as.numeric(etivencedef)),
    lupu2nd = as.numeric(lupu2nd),
    mri2nd = as.numeric(mri2nd),
    neuproce = as.numeric(neuproce),
    icu = as.numeric(icu),
    meven = as.numeric(meven),
    drugae = as.numeric(drugae),
    artstart = as.numeric(artstart),
    
    rifamdtc = ymd(rifamdtc),
    rifamstt = case_when(
      site == 'Jakarta' & rifamstt == '1' ~ 0, 
      site == 'Jakarta' & rifamstt == '2' ~ 1,
      site == 'Jakarta' & rifamstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(rifamstt),
      TRUE ~ NA_real_
    ),
    rifamrs = case_when(
      site == 'Jakarta' & rifamrs == '1' ~ 0,
      site == 'Jakarta' & rifamrs == '2' ~ 1,
      site == 'Jakarta' & rifamrs == '3' ~ 2,
      site == 'Jakarta' & rifamrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(rifamrs),
      TRUE ~ NA_real_
    ),
    isonidtc = ymd(isonidtc),
    isonistt = case_when(
      site == 'Jakarta' & isonistt == '1' ~ 0, 
      site == 'Jakarta' & isonistt == '2' ~ 1,
      site == 'Jakarta' & isonistt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(isonistt),
      TRUE ~ NA_real_
    ),
    isonirs = case_when(
      site == 'Jakarta' & isonirs == '1' ~ 0,
      site == 'Jakarta' & isonirs == '2' ~ 1,
      site == 'Jakarta' & isonirs == '3' ~ 2,
      site == 'Jakarta' & isonirs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(isonirs),
      TRUE ~ NA_real_
    ),
    pyradtc = ymd(pyradtc),
    pyrastt = case_when(
      site == 'Jakarta' & pyrastt == '1' ~ 0, 
      site == 'Jakarta' & pyrastt == '2' ~ 1,
      site == 'Jakarta' & pyrastt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(pyrastt),
      TRUE ~ NA_real_
    ),
    pyrars = case_when(
      site == 'Jakarta' & pyrars == '1' ~ 0,
      site == 'Jakarta' & pyrars == '2' ~ 1,
      site == 'Jakarta' & pyrars == '3' ~ 2,
      site == 'Jakarta' & pyrars == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(pyrars),
      TRUE ~ NA_real_
    ),
    ethamdtc = ymd(ethamdtc),
    ethamstt = case_when(
      site == 'Jakarta' & ethamstt == '1' ~ 0, 
      site == 'Jakarta' & ethamstt == '2' ~ 1,
      site == 'Jakarta' & ethamstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(ethamstt),
      TRUE ~ NA_real_
    ),
    ethamrs = case_when(
      site == 'Jakarta' & ethamrs == '1' ~ 0,
      site == 'Jakarta' & ethamrs == '2' ~ 1,
      site == 'Jakarta' & ethamrs == '3' ~ 2,
      site == 'Jakarta' & ethamrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(ethamrs),
      TRUE ~ NA_real_
    ),
    strepdtc = ymd(strepdtc),
    strepstt = case_when(
      site == 'Jakarta' & strepstt == '1' ~ 0, 
      site == 'Jakarta' & strepstt == '2' ~ 1,
      site == 'Jakarta' & strepstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(strepstt),
      TRUE ~ NA_real_
    ),
    streprs = case_when(
      site == 'Jakarta' & streprs == '1' ~ 0,
      site == 'Jakarta' & streprs == '2' ~ 1,
      site == 'Jakarta' & streprs == '3' ~ 2,
      site == 'Jakarta' & streprs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(streprs),
      TRUE ~ NA_real_
    ), 
    tbfdcdtc = ymd(tbfdcdtc),
    tbfdcstt = case_when(
      site == 'Jakarta' & tbfdcstt == '1' ~ 0, 
      site == 'Jakarta' & tbfdcstt == '2' ~ 1,
      site == 'Jakarta' & tbfdcstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(tbfdcstt),
      TRUE ~ NA_real_
    ),
    tbfdcrs = case_when(
      site == 'Jakarta' & tbfdcrs == '1' ~ 0,
      site == 'Jakarta' & tbfdcrs == '2' ~ 1,
      site == 'Jakarta' & tbfdcrs == '3' ~ 2,
      site == 'Jakarta' & tbfdcrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(tbfdcrs),
      TRUE ~ NA_real_
    ), 
    levodtc = ymd(levodtc),
    levostt = case_when(
      site == 'Jakarta' & levostt == '1' ~ 0, 
      site == 'Jakarta' & levostt == '2' ~ 1,
      site == 'Jakarta' & levostt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(levostt),
      TRUE ~ NA_real_
    ),
    levors = case_when(
      site == 'Jakarta' & levors == '1' ~ 0,
      site == 'Jakarta' & levors == '2' ~ 1,
      site == 'Jakarta' & levors == '3' ~ 2,
      site == 'Jakarta' & levors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(levors),
      TRUE ~ NA_real_
    ), 
    moxidtc = ymd(moxidtc),
    moxistt = case_when(
      site == 'Jakarta' & moxistt == '1' ~ 0, 
      site == 'Jakarta' & moxistt == '2' ~ 1,
      site == 'Jakarta' & moxistt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(moxistt),
      TRUE ~ NA_real_
    ),
    moxirs = case_when(
      site == 'Jakarta' & moxirs == '1' ~ 0,
      site == 'Jakarta' & moxirs == '2' ~ 1,
      site == 'Jakarta' & moxirs == '3' ~ 2,
      site == 'Jakarta' & moxirs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(moxirs),
      TRUE ~ NA_real_
    ), 
    pyrimedtc2 = ymd(pyrimedtc2),
    pyrimestt2 = case_when(
      site == 'Jakarta' & pyrimestt2 == '1' ~ 0, 
      site == 'Jakarta' & pyrimestt2 == '2' ~ 1,
      site == 'Jakarta' & pyrimestt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(pyrimestt2),
      TRUE ~ NA_real_
    ),
    pyrimers = case_when(
      site == 'Jakarta' & pyrimers == '1' ~ 0,
      site == 'Jakarta' & pyrimers == '2' ~ 1,
      site == 'Jakarta' & pyrimers == '3' ~ 2,
      site == 'Jakarta' & pyrimers == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(pyrimers),
      TRUE ~ NA_real_
    ), 
    clinddtc = ymd(clinddtc),
    clindstt = case_when(
      site == 'Jakarta' & clindstt == '1' ~ 0, 
      site == 'Jakarta' & clindstt == '2' ~ 1,
      site == 'Jakarta' & clindstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(clindstt),
      TRUE ~ NA_real_
    ),
    clindrs = case_when(
      site == 'Jakarta' & clindrs == '1' ~ 0,
      site == 'Jakarta' & clindrs == '2' ~ 1,
      site == 'Jakarta' & clindrs == '3' ~ 2,
      site == 'Jakarta' & clindrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(clindrs),
      TRUE ~ NA_real_
    ),
    cotridtc = ymd(cotridtc),
    cotristt = case_when(
      site == 'Jakarta' & cotristt == '1' ~ 0, 
      site == 'Jakarta' & cotristt == '2' ~ 1,
      site == 'Jakarta' & cotristt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(cotristt),
      TRUE ~ NA_real_
    ),
    cotrirs = case_when(
      site == 'Jakarta' & cotrirs == '1' ~ 0,
      site == 'Jakarta' & cotrirs == '2' ~ 1,
      site == 'Jakarta' & cotrirs == '3' ~ 2,
      site == 'Jakarta' & cotrirs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(cotrirs),
      TRUE ~ NA_real_
    ),
    metrodtc = ymd(metrodtc),
    metrostt = case_when(
      site == 'Jakarta' & metrostt == '1' ~ 0, 
      site == 'Jakarta' & metrostt == '2' ~ 1,
      site == 'Jakarta' & metrostt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(metrostt),
      TRUE ~ NA_real_
    ),
    metrors = case_when(
      site == 'Jakarta' & metrors == '1' ~ 0,
      site == 'Jakarta' & metrors == '2' ~ 1,
      site == 'Jakarta' & metrors == '3' ~ 2,
      site == 'Jakarta' & metrors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(metrors),
      TRUE ~ NA_real_
    ),
    flucodtc2 = ymd(flucodtc2),
    flucostt2 = case_when(
      site == 'Jakarta' & flucostt2 == '1' ~ 0, 
      site == 'Jakarta' & flucostt2 == '2' ~ 1,
      site == 'Jakarta' & flucostt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(flucostt2),
      TRUE ~ NA_real_
    ),
    flucors = case_when(
      site == 'Jakarta' & flucors == '1' ~ 0,
      site == 'Jakarta' & flucors == '2' ~ 1,
      site == 'Jakarta' & flucors == '3' ~ 2,
      site == 'Jakarta' & flucors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(flucors),
      TRUE ~ NA_real_
    ),
    amphodtc2 = ymd(amphodtc2),
    amphostt2 = case_when(
      site == 'Jakarta' & amphostt2 == '1' ~ 0, 
      site == 'Jakarta' & amphostt2 == '2' ~ 1,
      site == 'Jakarta' & amphostt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(amphostt2),
      TRUE ~ NA_real_
    ),
    amphors = case_when(
      site == 'Jakarta' & amphors == '1' ~ 0,
      site == 'Jakarta' & amphors == '2' ~ 1,
      site == 'Jakarta' & amphors == '3' ~ 2,
      site == 'Jakarta' & amphors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(amphors),
      TRUE ~ NA_real_
    ),
    ceftriadtc2 = ymd(ceftriadtc2),
    ceftriastt2 = case_when(
      site == 'Jakarta' & ceftriastt2 == '1' ~ 0, 
      site == 'Jakarta' & ceftriastt2 == '2' ~ 1,
      site == 'Jakarta' & ceftriastt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(ceftriastt2),
      TRUE ~ NA_real_
    ),
    ceftriars = case_when(
      site == 'Jakarta' & ceftriars == '1' ~ 0,
      site == 'Jakarta' & ceftriars == '2' ~ 1,
      site == 'Jakarta' & ceftriars == '3' ~ 2,
      site == 'Jakarta' & ceftriars == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(ceftriars),
      TRUE ~ NA_real_
    ),
    merodtc = ymd(merodtc),
    merostt = case_when(
      site == 'Jakarta' & merostt == '1' ~ 0, 
      site == 'Jakarta' & merostt == '2' ~ 1,
      site == 'Jakarta' & merostt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(merostt),
      TRUE ~ NA_real_
    ),
    merors = case_when(
      site == 'Jakarta' & merors == '1' ~ 0,
      site == 'Jakarta' & merors == '2' ~ 1,
      site == 'Jakarta' & merors == '3' ~ 2,
      site == 'Jakarta' & merors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(merors),
      TRUE ~ NA_real_
    ),
    acyclodtc2 = ymd(acyclodtc2),
    acyclostt2 = case_when(
      site == 'Jakarta' & acyclostt2 == '1' ~ 0, 
      site == 'Jakarta' & acyclostt2 == '2' ~ 1,
      site == 'Jakarta' & acyclostt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(acyclostt2),
      TRUE ~ NA_real_
    ),
    acyclors = case_when(
      site == 'Jakarta' & acyclors == '1' ~ 0,
      site == 'Jakarta' & acyclors == '2' ~ 1,
      site == 'Jakarta' & acyclors == '3' ~ 2,
      site == 'Jakarta' & acyclors == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(acyclors),
      TRUE ~ NA_real_
    ),
    valgandtc2 = ymd(valgandtc2),
    valganstt2 = case_when(
      site == 'Jakarta' & valganstt2 == '1' ~ 0, 
      site == 'Jakarta' & valganstt2 == '2' ~ 1,
      site == 'Jakarta' & valganstt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(valganstt2),
      TRUE ~ NA_real_
    ),
    valganrs = case_when(
      site == 'Jakarta' & valganrs == '1' ~ 0,
      site == 'Jakarta' & valganrs == '2' ~ 1,
      site == 'Jakarta' & valganrs == '3' ~ 2,
      site == 'Jakarta' & valganrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(valganrs),
      TRUE ~ NA_real_
    ),
    methyldtc2 = ymd(methyldtc2),
    methylstt2 = case_when(
      site == 'Jakarta' & methylstt2 == '1' ~ 0, 
      site == 'Jakarta' & methylstt2 == '2' ~ 1,
      site == 'Jakarta' & methylstt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(methylstt2),
      TRUE ~ NA_real_
    ),
    methylrs = case_when(
      site == 'Jakarta' & methylrs == '1' ~ 0,
      site == 'Jakarta' & methylrs == '2' ~ 1,
      site == 'Jakarta' & methylrs == '3' ~ 2,
      site == 'Jakarta' & methylrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(methylrs),
      TRUE ~ NA_real_
    ),
    mannidtc = ymd(mannidtc),
    mannistt = case_when(
      site == 'Jakarta' & mannistt == '1' ~ 0, 
      site == 'Jakarta' & mannistt == '2' ~ 1,
      site == 'Jakarta' & mannistt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(mannistt),
      TRUE ~ NA_real_
    ),
    mannirs = case_when(
      site == 'Jakarta' & mannirs == '1' ~ 0,
      site == 'Jakarta' & mannirs == '2' ~ 1,
      site == 'Jakarta' & mannirs == '3' ~ 2,
      site == 'Jakarta' & mannirs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(mannirs),
      TRUE ~ NA_real_
    ),
    furosedtc2 = ymd(furosedtc2),
    furosestt2 = case_when(
      site == 'Jakarta' & furosestt2 == '1' ~ 0, 
      site == 'Jakarta' & furosestt2 == '2' ~ 1,
      site == 'Jakarta' & furosestt2 == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(furosestt2),
      TRUE ~ NA_real_
    ),
    furosers = case_when(
      site == 'Jakarta' & furosers == '1' ~ 0,
      site == 'Jakarta' & furosers == '2' ~ 1,
      site == 'Jakarta' & furosers == '3' ~ 2,
      site == 'Jakarta' & furosers == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(furosers),
      TRUE ~ NA_real_
    ),
    rantididtc = ymd(rantididtc),
    ranitidistt = case_when(
      site == 'Jakarta' & ranitidistt == '1' ~ 0, 
      site == 'Jakarta' & ranitidistt == '2' ~ 1,
      site == 'Jakarta' & ranitidistt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(ranitidistt),
      TRUE ~ NA_real_
    ),
    ranitidirs = case_when(
      site == 'Jakarta' & ranitidirs == '1' ~ 0,
      site == 'Jakarta' & ranitidirs == '2' ~ 1,
      site == 'Jakarta' & ranitidirs == '3' ~ 2,
      site == 'Jakarta' & ranitidirs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(ranitidirs),
      TRUE ~ NA_real_
    ),
    arvdtc = ymd(arvdtc),
    arvstt = case_when(
      site == 'Jakarta' & arvstt == '1' ~ 0, 
      site == 'Jakarta' & arvstt == '2' ~ 1,
      site == 'Jakarta' & arvstt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(arvstt),
      TRUE ~ NA_real_
    ),
    arvrs = case_when(
      site == 'Jakarta' & arvrs == '1' ~ 0,
      site == 'Jakarta' & arvrs == '2' ~ 1,
      site == 'Jakarta' & arvrs == '3' ~ 2,
      site == 'Jakarta' & arvrs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(arvrs),
      TRUE ~ NA_real_
    ),
    
    treatoth1dtc = ymd(treatoth1dtc),
    treatoth1stt = case_when(
      site == 'Jakarta' & treatoth1stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth1stt == '2' ~ 1,
      site == 'Jakarta' & treatoth1stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth1stt),
      TRUE ~ NA_real_
    ),
    treatoth1rs = case_when(
      site == 'Jakarta' & treatoth1rs == '1' ~ 0,
      site == 'Jakarta' & treatoth1rs == '2' ~ 1,
      site == 'Jakarta' & treatoth1rs == '3' ~ 2,
      site == 'Jakarta' & treatoth1rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth1rs),
      TRUE ~ NA_real_
    ),
    
    treatoth2dtc = ymd(treatoth2dtc),
    treatoth2stt = case_when(
      site == 'Jakarta' & treatoth2stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth2stt == '2' ~ 1,
      site == 'Jakarta' & treatoth2stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth2stt),
      TRUE ~ NA_real_
    ),
    treatoth2rs = case_when(
      site == 'Jakarta' & treatoth2rs == '1' ~ 0,
      site == 'Jakarta' & treatoth2rs == '2' ~ 1,
      site == 'Jakarta' & treatoth2rs == '3' ~ 2,
      site == 'Jakarta' & treatoth2rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth2rs),
      TRUE ~ NA_real_
    ),
    
    treatoth3dtc = ymd(treatoth3dtc),
    treatoth3stt = case_when(
      site == 'Jakarta' & treatoth3stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth3stt == '2' ~ 1,
      site == 'Jakarta' & treatoth3stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth3stt),
      TRUE ~ NA_real_
    ),
    treatoth3rs = case_when(
      site == 'Jakarta' & treatoth3rs == '1' ~ 0,
      site == 'Jakarta' & treatoth3rs == '2' ~ 1,
      site == 'Jakarta' & treatoth3rs == '3' ~ 2,
      site == 'Jakarta' & treatoth3rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth3rs),
      TRUE ~ NA_real_
    ),
    
    treatoth4dtc = ymd(treatoth4dtc),
    treatoth4stt = case_when(
      site == 'Jakarta' & treatoth4stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth4stt == '2' ~ 1,
      site == 'Jakarta' & treatoth4stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth4stt),
      TRUE ~ NA_real_
    ),
    treatoth4rs = case_when(
      site == 'Jakarta' & treatoth4rs == '1' ~ 0,
      site == 'Jakarta' & treatoth4rs == '2' ~ 1,
      site == 'Jakarta' & treatoth4rs == '3' ~ 2,
      site == 'Jakarta' & treatoth4rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth4rs),
      TRUE ~ NA_real_
    ),
    
    treatoth5dtc = ymd(treatoth5dtc),
    treatoth5stt = case_when(
      site == 'Jakarta' & treatoth5stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth5stt == '2' ~ 1,
      site == 'Jakarta' & treatoth5stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth5stt),
      TRUE ~ NA_real_
    ),
    treatoth5rs = case_when(
      site == 'Jakarta' & treatoth5rs == '1' ~ 0,
      site == 'Jakarta' & treatoth5rs == '2' ~ 1,
      site == 'Jakarta' & treatoth5rs == '3' ~ 2,
      site == 'Jakarta' & treatoth5rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth5rs),
      TRUE ~ NA_real_
    ),
    
    treatoth6dtc = ymd(treatoth6dtc),
    treatoth6stt = case_when(
      site == 'Jakarta' & treatoth6stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth6stt == '2' ~ 1,
      site == 'Jakarta' & treatoth6stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth6stt),
      TRUE ~ NA_real_
    ),
    treatoth6rs = case_when(
      site == 'Jakarta' & treatoth6rs == '1' ~ 0,
      site == 'Jakarta' & treatoth6rs == '2' ~ 1,
      site == 'Jakarta' & treatoth6rs == '3' ~ 2,
      site == 'Jakarta' & treatoth6rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth6rs),
      TRUE ~ NA_real_
    ),
    
    treatoth7dtc = ymd(treatoth7dtc),
    treatoth7stt = case_when(
      site == 'Jakarta' & treatoth7stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth7stt == '2' ~ 1,
      site == 'Jakarta' & treatoth7stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth7stt),
      TRUE ~ NA_real_
    ),
    treatoth7rs = case_when(
      site == 'Jakarta' & treatoth7rs == '1' ~ 0,
      site == 'Jakarta' & treatoth7rs == '2' ~ 1,
      site == 'Jakarta' & treatoth7rs == '3' ~ 2,
      site == 'Jakarta' & treatoth7rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth7rs),
      TRUE ~ NA_real_
    ),
    
    treatoth8dtc = ymd(treatoth8dtc),
    treatoth8stt = case_when(
      site == 'Jakarta' & treatoth8stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth8stt == '2' ~ 1,
      site == 'Jakarta' & treatoth8stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth8stt),
      TRUE ~ NA_real_
    ),
    treatoth8rs = case_when(
      site == 'Jakarta' & treatoth8rs == '1' ~ 0,
      site == 'Jakarta' & treatoth8rs == '2' ~ 1,
      site == 'Jakarta' & treatoth8rs == '3' ~ 2,
      site == 'Jakarta' & treatoth8rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth8rs),
      TRUE ~ NA_real_
    ),
    
    treatoth9dtc = ymd(treatoth9dtc),
    treatoth9stt = case_when(
      site == 'Jakarta' & treatoth9stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth9stt == '2' ~ 1,
      site == 'Jakarta' & treatoth9stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth9stt),
      TRUE ~ NA_real_
    ),
    treatoth9rs = case_when(
      site == 'Jakarta' & treatoth9rs == '1' ~ 0,
      site == 'Jakarta' & treatoth9rs == '2' ~ 1,
      site == 'Jakarta' & treatoth9rs == '3' ~ 2,
      site == 'Jakarta' & treatoth9rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth9rs),
      TRUE ~ NA_real_
    ),
    
    treatoth10dtc = ymd(treatoth10dtc),
    treatoth10stt = case_when(
      site == 'Jakarta' & treatoth10stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth10stt == '2' ~ 1,
      site == 'Jakarta' & treatoth10stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth10stt),
      TRUE ~ NA_real_
    ),
    treatoth10rs = case_when(
      site == 'Jakarta' & treatoth10rs == '1' ~ 0,
      site == 'Jakarta' & treatoth10rs == '2' ~ 1,
      site == 'Jakarta' & treatoth10rs == '3' ~ 2,
      site == 'Jakarta' & treatoth10rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth10rs),
      TRUE ~ NA_real_
    ),
    
    treatoth11dtc = ymd(treatoth11dtc),
    treatoth11stt = case_when(
      site == 'Jakarta' & treatoth11stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth11stt == '2' ~ 1,
      site == 'Jakarta' & treatoth11stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth11stt),
      TRUE ~ NA_real_
    ),
    treatoth11rs = case_when(
      site == 'Jakarta' & treatoth11rs == '1' ~ 0,
      site == 'Jakarta' & treatoth11rs == '2' ~ 1,
      site == 'Jakarta' & treatoth11rs == '3' ~ 2,
      site == 'Jakarta' & treatoth11rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth11rs),
      TRUE ~ NA_real_
    ),
    
    treatoth12dtc = ymd(treatoth12dtc),
    treatoth12stt = case_when(
      site == 'Jakarta' & treatoth12stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth12stt == '2' ~ 1,
      site == 'Jakarta' & treatoth12stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth12stt),
      TRUE ~ NA_real_
    ),
    treatoth12rs = case_when(
      site == 'Jakarta' & treatoth12rs == '1' ~ 0,
      site == 'Jakarta' & treatoth12rs == '2' ~ 1,
      site == 'Jakarta' & treatoth12rs == '3' ~ 2,
      site == 'Jakarta' & treatoth12rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth12rs),
      TRUE ~ NA_real_
    ),
    
    treatoth13dtc = ymd(treatoth13dtc),
    treatoth13stt = case_when(
      site == 'Jakarta' & treatoth13stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth13stt == '2' ~ 1,
      site == 'Jakarta' & treatoth13stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth13stt),
      TRUE ~ NA_real_
    ),
    treatoth13rs = case_when(
      site == 'Jakarta' & treatoth13rs == '1' ~ 0,
      site == 'Jakarta' & treatoth13rs == '2' ~ 1,
      site == 'Jakarta' & treatoth13rs == '3' ~ 2,
      site == 'Jakarta' & treatoth13rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth13rs),
      TRUE ~ NA_real_
    ),
    
    treatoth14dtc = ymd(treatoth14dtc),
    treatoth14stt = case_when(
      site == 'Jakarta' & treatoth14stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth14stt == '2' ~ 1,
      site == 'Jakarta' & treatoth14stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth14stt),
      TRUE ~ NA_real_
    ),
    treatoth14rs = case_when(
      site == 'Jakarta' & treatoth14rs == '1' ~ 0,
      site == 'Jakarta' & treatoth14rs == '2' ~ 1,
      site == 'Jakarta' & treatoth14rs == '3' ~ 2,
      site == 'Jakarta' & treatoth14rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth14rs),
      TRUE ~ NA_real_
    ),
    
    treatoth15dtc = ymd(treatoth15dtc),
    treatoth15stt = case_when(
      site == 'Jakarta' & treatoth15stt == '1' ~ 0, 
      site == 'Jakarta' & treatoth15stt == '2' ~ 1,
      site == 'Jakarta' & treatoth15stt == '3' ~ 2,
      site == 'Bandung' ~ as.numeric(treatoth15stt),
      TRUE ~ NA_real_
    ),
    treatoth15rs = case_when(
      site == 'Jakarta' & treatoth15rs == '1' ~ 0,
      site == 'Jakarta' & treatoth15rs == '2' ~ 1,
      site == 'Jakarta' & treatoth15rs == '3' ~ 2,
      site == 'Jakarta' & treatoth15rs == '4' ~ 3,
      site == 'Bandung' ~ as.numeric(treatoth15rs),
      TRUE ~ NA_real_
    ),
    
    # Assume '9' as '3' for the Jakarta site for `xray_s` only
    xray_s = if_else(xray_s %in% c('2', '3'), 2, as.numeric(xray_s)),
    
    # Transform as indicated in the dictionary
    ctscan = if_else(ctscan %in% c('2', '9'), 2, as.numeric(ctscan)),
    bmri = if_else(bmri %in% c('2', '9'), 2, as.numeric(bmri)),
    smri = if_else(smri %in% c('2', '9'), 2, as.numeric(smri)),
    bserum = if_else(bserum %in% c('2', '9'), 2, as.numeric(bserum)),
    cserum = if_else(cserum %in% c('2', '9'), 2, as.numeric(cserum)),
    bplasma = if_else(bplasma %in% c('2', '9'), 2, as.numeric(bplasma)),
    dna = if_else(dna %in% c('2', '9'), 2, as.numeric(dna)),
    bcsf = if_else(bcsf %in% c('2', '9'), 2, as.numeric(bcsf)),
    fucsf = if_else(fucsf %in% c('2', '9'), 2, as.numeric(fucsf)),
    urine = if_else(urine %in% c('2', '9'), 2, as.numeric(urine)),
    isolate = if_else(isolate %in% c('2', '9'), 2, as.numeric(isolate)),
    oth = if_else(oth %in% c('2', '9'), 2, as.numeric(oth)),
    fudtc = ymd(fudtc),
    moass = if_else(moass %in% c('0', '4'), 0, as.numeric(moass)),
    rehosp6m = as.numeric(rehosp6m),
    rehospdtc = ymd(rehospdtc),
    pacontdtc = ymd(pacontdtc),
    tbmedi_sc = case_when(
      site == 'Jakarta' & tbmedi_sc == '2' ~ 0,
      site == 'Jakarta' & tbmedi_sc == '1' ~ 1,
      site == 'Jakarta' & tbmedi_sc == '3' ~ 2,
      site == 'Jakarta' & tbmedi_sc == '9' ~ 9,
      site == 'Bandung' & tbmedi_sc == '0' ~ 0,
      site == 'Bandung' & tbmedi_sc == '1' ~ 1,
      site == 'Bandung' & tbmedi_sc == '2'~ 2,
      site == 'Bandung' & tbmedi_sc == 'Unknown' ~ 9,
      TRUE ~ NA_real_
    ),
    antoxomedi = case_when(
      site == 'Jakarta' & antoxomedi == '2' ~ 0,
      site == 'Jakarta' & antoxomedi == '1' ~ 1,
      site == 'Jakarta' & antoxomedi == '3' ~ 2,
      site == 'Jakarta' & antoxomedi == '9' ~ 9,
      site == 'Bandung' & antoxomedi == '0' ~ 0,
      site == 'Bandung' & antoxomedi == '1' ~ 1,
      site == 'Bandung' & antoxomedi == '2'~ 2,
      site == 'Bandung' & antoxomedi == 'Unknown' ~ 9,
      TRUE ~ NA_real_
    ), 
    ancrypmedi = case_when(
      site == 'Jakarta' & ancrypmedi == '2' ~ 0,
      site == 'Jakarta' & ancrypmedi == '1' ~ 1,
      site == 'Jakarta' & ancrypmedi == '3' ~ 2,
      site == 'Jakarta' & ancrypmedi == '9' ~ 9,
      site == 'Bandung' & ancrypmedi == '0' ~ 0,
      site == 'Bandung' & ancrypmedi == '1' ~ 1,
      site == 'Bandung' & ancrypmedi == '2'~ 2,
      site == 'Bandung' & ancrypmedi == 'Unknown' ~ 9,
      TRUE ~ NA_real_
  ),
  art_sc = case_when(
     site == 'Jakarta' & art_sc == '1' ~ 3,
     site == 'Jakarta' & art_sc == '2' ~ 0,
     site == 'Jakarta' & art_sc == '3' ~ 1,
     site == 'Jakarta' & art_sc == '9' ~ 9,
     site == 'Bandung' & art_sc == '0' ~ 0,
     site == 'Bandung' & art_sc == '1' ~ 1,
     site == 'Bandung' & art_sc == '2' ~ 2,
     TRUE ~ NA_real_
  ),
  neurocase_sc = as.numeric(neurocase_sc),
  mtubestt = case_when(
    site == 'Jakarta' & mtubestt == '1' ~ 0,
    site == 'Jakarta' & mtubestt == '2' ~ 1,
    site == 'Jakarta' & mtubestt == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(mtubestt),
    TRUE ~ NA_real_
  ),
  tbmgrade_sc = factor(tbmgrade_sc,
                       levels = c(0, 1, 2)),
  tbmgrade_sc = ordered(tbmgrade_sc, levels = c(0, 1, 2)),
  pararea_sc = if_else(pararea_sc %in% c('8', '9'), 2, as.numeric(pararea_sc)),
  afb = if_else(afb %in% c('2', '9'), 2, as.numeric(afb)),
  mtubecult = if_else(mtubecult %in% c('2', '9'), 2, as.numeric(mtubecult)),
  mtubexpert = if_else(mtubexpert %in% c('2', '9'), 2, as.numeric(mtubexpert)),
  toxostt = case_when(
    site == 'Jakarta' & toxostt == '1' ~ 0,
    site == 'Jakarta' & toxostt == '2' ~ 1,
    site == 'Jakarta' & toxostt == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(toxostt),
    TRUE ~ NA_real_
  ),
  cryptstt = case_when(
    site == 'Jakarta' & cryptstt == '1' ~ 0,
    site == 'Jakarta' & cryptstt == '2' ~ 1,
    site == 'Jakarta' & cryptstt == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(cryptstt),
    TRUE ~ NA_real_
  ),
  bacmenstt = case_when(
    site == 'Jakarta' & bacmenstt == '1' ~ 0,
    site == 'Jakarta' & bacmenstt == '2' ~ 1,
    site == 'Jakarta' & bacmenstt == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(bacmenstt),
    TRUE ~ NA_real_
  ),
  gstain = case_when(
    site == 'Jakarta' & gstain == '0' ~ 3,
    site == 'Jakarta' & gstain == '1' ~ 1,
    site == 'Jakarta' & gstain == '2' ~ 0,
    site == 'Jakarta' & gstain == '9' ~ 2,
    site == 'Bandung' ~ as.numeric(gstain),
    TRUE ~ NA_real_
  ),
  gstaincult = if_else(gstaincult %in% c('2', '9'), 2, as.numeric(gstaincult)),
  vencepstt = case_when(
    site == 'Jakarta' & vencepstt == '1' ~ 0,
    site == 'Jakarta' & vencepstt == '2' ~ 1,
    site == 'Jakarta' & vencepstt == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(vencepstt),
    TRUE ~ NA_real_
  ),
  vencepdef = if_else(vencepdef %in% c('5', '0'), 0, as.numeric(vencepdef)),
  deathdtc_sc = ymd(deathdtc_sc),
  deathplace = case_when(
    site == 'Jakarta' & deathplace == '1' ~ 1,
    site == 'Jakarta' & deathplace == '2' ~ 0,
    site == 'Jakarta' & deathplace == '3' ~ 2,
    site == 'Bandung' ~ as.numeric(deathplace),
    TRUE ~ NA_real_
  ),
  tbdrug_sc = case_when(
    site == 'Jakarta' & tbdrug_sc == '1' ~ 1,
    site == 'Jakarta' & tbdrug_sc == '2' ~ 0,
    site == 'Bandung' ~ as.numeric(tbdrug_sc),
    TRUE ~ NA_real_
  ),
  arv = case_when(
    site == 'Jakarta' & arv == '1' ~ 1,
    site == 'Jakarta' & arv == '2' ~ 0,
    site == 'Jakarta' & arv == '3' ~ 2,
    TRUE ~ NA_real_
  ),
  deathrs = case_when(
    site == 'Jakarta' & deathrs == '1' ~ 1,
    site == 'Jakarta' & deathrs == '2' ~ 2,
    site == 'Jakarta' & deathrs == '3' ~ 6,
    site == 'Jakarta' & deathrs == '4' ~ 5,
    site == 'Bandung' & deathrs == '1' ~ 1,
    site == 'Bandung' & deathrs == '2' ~ 2,
    site == 'Bandung' & deathrs == '3' ~ 3,
    site == 'Bandung' & deathrs == '4' ~ 4,
    site == 'Bandung' & deathrs == '5' ~ 5,
    TRUE ~ NA_real_
  )
  ) |>
  
  # Make sure all categories are present despite missingness
  mutate(
    deathrs = factor(deathrs,
                     levels = c(1, 2, 3, 4, 5, 6),
                     labels = c('Neurological', 'Respiratory illness',
                                'Systemic illness', 'Sepsis',
                                'Other', 'Systemic illness / sepsis')),
    arv = factor(arv,
                 levels = c(0, 1, 2),
                 labels = c('Interrupted', 'Continuous', 'No ARV')),
    tbdrug_sc = factor(tbdrug_sc,
                       levels = c(0, 1),
                       labels = c('Interrupted', 'Continuous')),
    deathplace = factor(deathplace,
                        levels = c(0, 1, 2),
                        labels = c('Home', 'Hospital', 'Other')),
    etioth_sc = factor(etioth_sc,
                       levels = c(0, 1),
                       labels = c('No', 'Yes')),
    etiothnmdar_sc = factor(etiothnmdar_sc,
                            levels = c(0, 1),
                            labels = c('No', 'Yes')),
    etiothlym_sc = factor(etiothlym_sc,
                          levels = c(0, 1),
                          labels = c('No', 'Yes')),
    etiothneu_sc = factor(etiothneu_sc,
                          levels = c(0, 1),
                          labels = c('No', 'Yes')),
    etiothbm_sc = factor(etiothbm_sc,
                           levels = c(0, 1),
                           labels = c('No', 'Yes')),
    etiothmuco_sc = factor(etiothmuco_sc,
                           levels = c(0, 1),
                           labels = c('No', 'Yes')),
    etiothba_sc = factor(etiothba_sc,
                         levels = c(0, 1),
                         labels = c('No', 'Yes')),
    vencepdef = factor(vencepdef,
                       levels = c(0, 1, 2, 3, 4),
                       labels = c('Other', 'PCR CMV+', 'PCR HSV+', 'PCR EBV+',
                                  'PCR VZV+')),
    vencepstt = factor(vencepstt,
                       levels = c(0, 1, 2),
                       labels = c('Definite', 'Probable', 'Possible')),
    vencep = factor(vencep,
                    levels = c(0, 1),
                    labels = c('No', 'Yes')),
    gstaincult = factor(gstaincult,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    gstain = factor(gstain,
                    levels = c(0, 1, 2, 3),
                    labels = c('Negative', 'Positive',
                               'Not done', 'No results')),
    bacmenstt = factor(bacmenstt,
                       levels = c(0, 1, 2),
                       labels = c('Definite', 'Probable', 'Possible')),
    bacmen = factor(bacmen,
                    levels = c(0, 1),
                    labels = c('Yes', 'No')),
    cryptstt = factor(cryptstt,
                      levels = c(0, 1, 2),
                      labels = c('Microscopy', 'Antigen', 'Culture')),
    crypto = factor(crypto,
                    levels = c(0, 1),
                    labels = c('Yes', 'No')),
    toxostt = factor(toxostt,
                     levels = c(0, 1, 2),
                     labels = c('Definite', 'Probable', 'Possible')),
    toxo = factor(toxo,
                  levels = c(0, 1),
                  labels = c('Yes', 'No')),
    mtubexpert = factor(mtubexpert,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    mtubecult = factor(mtubecult,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    afb = factor(afb,
                 levels = c(0, 1, 2),
                 labels = c('Negative', 'Positive', 'Not done')),
    pararea_sc = factor(pararea_sc,
                        levels = c(0, 1, 2),
                        labels = c('No', 'Yes', 'Unknown')),
    mtubestt = factor(mtubestt,
                      levels = c(0, 1, 2),
                      labels = c('Definite', 'Probable', 'Possible')),
    mtuber_sc = factor(mtuber_sc,
                       levels = c(0, 1),
                       labels = c('No', 'Yes')),
    neurocase_sc = factor(neurocase_sc,
                          levels = c(0, 1),
                          labels = c('No', 'Yes')),
    art_sc = factor(art_sc,
                    levels = c(0, 1, 2, 3, 9),
                    labels = c('Ongoing', 'Interrupted',
                               'Started after discharged',
                               'Completed', 'Unknown')),
    ancrypmedi = factor(ancrypmedi,
                        levels = c(0, 1, 2, 9),
                        labels = c('Ongoing', 'Completed',
                                   'Interrupted', 'Unknown')),
    antoxomedi = factor(antoxomedi,
                        levels = c(0, 1, 2, 9),
                        labels = c('Ongoing', 'Completed',
                                   'Interrupted', 'Unknown')),
    tbmedi_sc = factor(tbmedi_sc,
                       levels = c(0, 1, 2, 9),
                       labels = c('Ongoing', 'Completed',
                                  'Interrupted', 'Unknown')),
    rehosp6m = factor(rehosp6m,
                      levels = c(0, 1),
                      labels = c('No', 'Yes')),
    moass = factor(moass,
                   levels = c(0, 1, 2, 3),
                   labels = c('No contact could be made',
                              'In person',
                              'Phone call with patient',
                              'Phone call with family')),
    oth = factor(oth,
                 levels = c(0, 1, 2),
                 labels = c('No', 'Yes', 'Not done')),
    isolate = factor(isolate,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Not done')),
    urine = factor(urine,
                   levels = c(0, 1, 2),
                   labels = c('No', 'Yes', 'Not done')),
    fucsf = factor(fucsf,
                   levels = c(0, 1, 2),
                   labels = c('No', 'Yes', 'Not done')),
    bcsf = factor(bcsf,
                  levels = c(0, 1, 2),
                  labels = c('No', 'Yes', 'Not done')),
    dna = factor(dna,
                 levels = c(0, 1, 2),
                 labels = c('No', 'Yes', 'Not done')),
    bplasma = factor(bplasma,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Not done')),
    cserum = factor(cserum,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Not done')),
    bserum = factor(bserum,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Not done')),
    smri = factor(smri,
                  levels = c(0, 1, 2),
                  labels = c('No', 'Yes', 'Not done')),
    bmri = factor(bmri,
                  levels = c(0, 1, 2),
                  labels = c('No', 'Yes', 'Not done')),
    ctscan = factor(ctscan,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Not done')),
    xray_s = factor(xray_s,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Not done')),
    treatoth15stt = factor(treatoth15stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth15rs = factor(treatoth15rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth14stt = factor(treatoth14stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth14rs = factor(treatoth14rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth13stt = factor(treatoth13stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth13rs = factor(treatoth13rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth12stt = factor(treatoth12stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth12rs = factor(treatoth12rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth11stt = factor(treatoth10stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth11rs = factor(treatoth10rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth10stt = factor(treatoth10stt,
                           levels = c(0, 1, 2),
                           labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth10rs = factor(treatoth10rs,
                          levels = c(0, 1, 2, 3),
                          labels = c('Unavailable', 'DILI',
                                     'Allergy', 'Other')),
    treatoth9stt = factor(treatoth9stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth9rs = factor(treatoth9rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth8stt = factor(treatoth8stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth8rs = factor(treatoth8rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth7stt = factor(treatoth7stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth7rs = factor(treatoth7rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth6stt = factor(treatoth6stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth6rs = factor(treatoth6rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth5stt = factor(treatoth5stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth5rs = factor(treatoth5rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth4stt = factor(treatoth4stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth4rs = factor(treatoth4rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth3stt = factor(treatoth3stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth3rs = factor(treatoth3rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth2stt = factor(treatoth2stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth2rs = factor(treatoth2rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    treatoth1stt = factor(treatoth1stt,
                          levels = c(0, 1, 2),
                          labels = c('Ongoing', 'Completed', 'Interrupted')),
    treatoth1rs = factor(treatoth1rs,
                         levels = c(0, 1, 2, 3),
                         labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    
    arvstt = factor(arvstt,
                    levels = c(0, 1, 2),
                    labels = c('Ongoing', 'Completed', 'Interrupted')),
    arvrs = factor(arvrs,
                   levels = c(0, 1, 2, 3),
                   labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    ranitidistt = factor(ranitidistt,
                         levels = c(0, 1, 2),
                         labels = c('Ongoing', 'Completed', 'Interrupted')),
    ranitidirs = factor(ranitidirs,
                        levels = c(0, 1, 2, 3),
                        labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    furosestt2 = factor(furosestt2,
                        levels = c(0, 1, 2),
                        labels = c('Ongoing', 'Completed', 'Interrupted')),
    furosers = factor(furosers,
                      levels = c(0, 1, 2, 3),
                      labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    mannistt = factor(mannistt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    mannirs = factor(mannirs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    methylstt2 = factor(methylstt2,
                        levels = c(0, 1, 2),
                        labels = c('Ongoing', 'Completed', 'Interrupted')),
    methylrs = factor(methylrs,
                      levels = c(0, 1, 2, 3),
                      labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    valganstt2 = factor(valganstt2,
                        levels = c(0, 1, 2),
                        labels = c('Ongoing', 'Completed', 'Interrupted')),
    valganrs = factor(valganrs,
                      levels = c(0, 1, 2, 3),
                      labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    acyclostt2 = factor(acyclostt2,
                        levels = c(0, 1, 2),
                        labels = c('Ongoing', 'Completed', 'Interrupted')),
    acyclors = factor(acyclors,
                      levels = c(0, 1, 2, 3),
                      labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    merostt = factor(merostt,
                     levels = c(0, 1, 2),
                     labels = c('Ongoing', 'Completed', 'Interrupted')),
    merors = factor(merors,
                    levels = c(0, 1, 2, 3),
                    labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    ceftriastt2 = factor(ceftriastt2,
                         levels = c(0, 1, 2),
                         labels = c('Ongoing', 'Completed', 'Interrupted')),
    ceftriars = factor(ceftriars,
                       levels = c(0, 1, 2, 3),
                       labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    amphostt2 = factor(amphostt2,
                       levels = c(0, 1, 2),
                       labels = c('Ongoing', 'Completed', 'Interrupted')),
    amphors = factor(amphors,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    flucostt2 = factor(flucostt2,
                       levels = c(0, 1, 2),
                       labels = c('Ongoing', 'Completed', 'Interrupted')),
    flucors = factor(flucors,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    metrostt = factor(metrostt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    metrors = factor(metrors,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    cotristt = factor(cotristt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    cotrirs = factor(cotrirs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    clindstt = factor(clindstt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    clindrs = factor(clindrs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    pyrimestt2 = factor(pyrimestt2,
                        levels = c(0, 1, 2),
                        labels = c('Ongoing', 'Completed', 'Interrupted')),
    pyrimers = factor(pyrimers,
                      levels = c(0, 1, 2, 3),
                      labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    moxistt = factor(moxistt,
                     levels = c(0, 1, 2),
                     labels = c('Ongoing', 'Completed', 'Interrupted')),
    moxirs = factor(moxirs,
                    levels = c(0, 1, 2, 3),
                    labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    levostt = factor(levostt,
                     levels = c(0, 1, 2),
                     labels = c('Ongoing', 'Completed', 'Interrupted')),
    levors = factor(levors,
                    levels = c(0, 1, 2, 3),
                    labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    tbfdcstt = factor(tbfdcstt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    tbfdcrs = factor(tbfdcrs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    strepstt = factor(strepstt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    streprs = factor(streprs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    ethamstt = factor(ethamstt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    ethamrs = factor(ethamrs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    pyrastt = factor(pyrastt,
                     levels = c(0, 1, 2),
                     labels = c('Ongoing', 'Completed', 'Interrupted')),
    pyrars = factor(pyrars,
                    levels = c(0, 1, 2, 3),
                    labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    isonistt = factor(isonistt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    isonirs = factor(isonirs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    rifamstt = factor(rifamstt,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    rifamrs = factor(rifamrs,
                     levels = c(0, 1, 2, 3),
                     labels = c('Unavailable', 'DILI', 'Allergy', 'Other')),
    
    artstart = factor(artstart,
                      levels = c(0, 1),
                      labels = c('No', 'Yes')),
    drugae = factor(drugae,
                    levels = c(0, 1),
                    labels = c('No', 'Yes')),
    meven = factor(meven,
                   levels = c(0, 1),
                   labels = c('No', 'Yes')),
    icu = factor(icu,
                 levels = c(0, 1),
                 labels = c('No', 'Yes')),
    neuproce = factor(neuproce,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Drain', 'Shunt')),
    mri2nd = factor(mri2nd,
                    levels = c(0, 1),
                    labels = c('No', 'Yes')),
    lupu2nd = factor(lupu2nd,
                     levels = c(0, 1),
                     labels = c('No', 'Yes')),
    etioth = factor(etioth,
                    levels = c(0, 1),
                    labels = c('No', 'Yes')),
    etivencedef = factor(etivencedef,
                         levels = c(0, 1, 2, 3, 4),
                         labels = c('Other',
                                    'PCR CMV+',
                                    'PCR HSV+',
                                    'PCR EBV+',
                                    'PCR VZV+')),
    etibaccult = factor(etibaccult,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    etigstain = factor(etigstain,
                       levels = c(0, 1, 2, 3),
                       labels = c('Negative',
                                  'Positive',
                                  'Not done',
                                  'No result')),
    etixpert = factor(etixpert,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    eticult = factor(eticult,
                     levels = c(0, 1, 2),
                     labels = c('Negative', 'Positive', 'Not done')),
    etiafb = factor(etiafb,
                    levels = c(0, 1, 2),
                    labels = c('Negative', 'Positive', 'Not done')),
    etipara = factor(etipara,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Unknown')),
    mrind = factor(mrind,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    bicontrast3 = factor(bicontrast3,
                         levels = c(0, 1),
                         labels = c('Without contrast', 'With contrast')),
    bitype3 = factor(bitype3,
                     levels = c(0, 1),
                     labels = c('CT scan', 'MRI')),
    bicontrast2 = factor(bicontrast2,
                         levels = c(0, 1),
                         labels = c('Without contrast', 'With contrast')),
    bitype2 = factor(bitype2,
                     levels = c(0, 1),
                     labels = c('CT scan', 'MRI')),
    bicontrast1 = factor(bicontrast1,
                         levels = c(0, 1),
                         labels = c('Without contrast', 'With contrast')),
    bitype1 = factor(bitype1,
                     levels = c(0, 1),
                     labels = c('CT scan', 'MRI')),
    pcrtb1 = factor(pcrtb1,
                    levels = c(0, 1, 2),
                    labels = c('Negative', 'Positive', 'Not done')),
    pcrtb2 = factor(pcrtb2,
                    levels = c(0, 1, 2),
                    labels = c('Negative', 'Positive', 'Not done')),
    hivviloadnd1 = factor(hivviloadnd1,
                          levels = c(0, 1),
                          labels = c('Done', 'Not done')),
    hivviloadnd2 = factor(hivviloadnd2,
                          levels = c(0, 1),
                          labels = c('Done', 'Not done')),
    csfnmdar1 = factor(csfnmdar1,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    csfnmdar2 = factor(csfnmdar2,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    mycocult1 = factor(mycocult1,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    mycocult2 = factor(mycocult2,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    crypcult1 = factor(crypcult1,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    crypcult2 = factor(crypcult2,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    baccult1 = factor(baccult1,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    baccult2 = factor(baccult2,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    ininksmear1 = factor(ininksmear1,
                         levels = c(0, 1, 2),
                         labels = c('Negative', 'Positive', 'Not done')),
    ininksmear2 = factor(ininksmear2,
                         levels = c(0, 1, 2),
                         labels = c('Negative', 'Positive', 'Not done')),
    znsmear1 = factor(znsmear1,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    znsmear2 = factor(znsmear2,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    gramstain1 = factor(gramstain1,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    gramstain2 = factor(gramstain2,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    gramstain1 = factor(gramstain1,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    gramstain2 = factor(gramstain2,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    appearance2 = factor(appearance2,
                         levels = c(0, 1, 2, 3),
                         labels = c('Not recorded',
                                    'Clear',
                                    'Mildly cloudy',
                                    'Very cloudly/pus-like')),
    appearance1 = factor(appearance1,
                         levels = c(0, 1, 2, 3),
                         labels = c('Not recorded',
                                    'Clear',
                                    'Mildly cloudy',
                                    'Very cloudly/pus-like')),
    oppressunm1 = factor(oppressunm1,
                         levels = c(0, 1),
                         labels = c('No', 'Yes')),
    oppressunm2 = factor(oppressunm2,
                         levels = c(0, 1),
                         labels = c('No', 'Yes')),
    sptype1 = factor(sptype1,
                     levels = c(1, 2),
                     labels = c('Lumbar puncture', 'Ventricular drain')),
    sptype2 = factor(sptype2,
                     levels = c(1, 2),
                     labels = c('Lumbar puncture', 'Ventricular drain')),
    csfsample1 = factor(csfsample1,
                        levels = c(1, 2),
                        labels = c('First', 'Second')),
    csfsample2 = factor(csfsample2,
                        levels = c(1, 2),
                        labels = c('First', 'Second')),
    cd4stt = factor(cd4stt,
                    levels = c(0, 1),
                    labels = c('Never done', 'Unknown')),
    viloadstt = factor(viloadstt,
                       levels = c(0, 1),
                       labels = c('Never done', 'Unknown')),
    hivmususstt = factor(hivmususstt,
                         levels = c(0, 1),
                         labels = c('Never done', 'Unknown')),
    cotripro = factor(cotripro,
                      levels = c(0, 1, 2, 3),
                      labels = c('Never', 'Current', 'Previous', 'Unknown')),
    arths = factor(arths,
                   levels = c(0, 1, 2, 3),
                   labels = c('Never', 'Current', 'Ever', 'Unknown')),
    alerevalue = factor(alerevalue,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    fujilamvalue = factor(fujilamvalue,
                          levels = c(0, 1, 2),
                          labels = c('Negative', 'Positive', 'Not done')),
    nmdarvalue = factor(nmdarvalue,
                        levels = c(0, 1, 2),
                        labels = c('Negative', 'Positive', 'Not done')),
    tphavalue = factor(tphavalue,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    vdrlvalue = factor(vdrlvalue,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    hivvlnd = factor(hivvlnd,
                     levels = c(0, 1),
                     labels = c('Done', 'Not done')),
    cd4nd = factor(cd4nd,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    procalnd = factor(procalnd,
                      levels = c(0, 1),
                      labels = c('Done', 'Not done')),
    crpnd = factor(crpnd,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    hcvvalue = factor(hcvvalue,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    bilirund = factor(bilirund,
                      levels = c(0, 1),
                      labels = c('Done', 'Not done')),
    hband = factor(hband,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    sodiumnd = factor(sodiumnd,
                      levels = c(0, 1),
                      labels = c('Done', 'Not done')),
    creatnd = factor(creatnd,
                     levels = c(0, 1),
                     labels = c('Done', 'Not done')),
    altnd = factor(altnd,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    platend = factor(platend,
                     levels = c(0, 1),
                     labels = c('Done', 'Not done')),
    eosind = factor(eosind,
                    levels = c(0, 1),
                    labels = c('Done', 'Not done')),
    lympnd = factor(lympnd,
                    levels = c(0, 1),
                    labels = c('Done', 'Not done')),
    monond = factor(monond,
                    levels = c(0, 1),
                    labels = c('Done', 'Not done')),
    neund = factor(neund,
                   levels = c(0, 1),
                   labels = c('Done', 'Not done')),
    wcellcnd = factor(wcellcnd,
                      levels = c(0, 1),
                      labels = c('Done', 'Not done')),
    hemand = factor(hemand,
                    levels = c(0, 1),
                    labels = c('Done', 'Not done')),
    hemond = factor(hemond,
                    levels = c(0, 1),
                    labels = c('Done', 'Not done')),
    oth15stt = factor(oth15stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth15 = factor(oth15,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth14stt = factor(oth14stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth14 = factor(oth14,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth13stt = factor(oth13stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth13 = factor(oth13,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth12stt = factor(oth12stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth12 = factor(oth12,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth11stt = factor(oth11stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth11 = factor(oth11,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth10stt = factor(oth10stt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    oth10 = factor(oth10,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    oth9stt = factor(oth9stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth9 = factor(oth9,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth8stt = factor(oth8stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth8 = factor(oth8,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth7stt = factor(oth7stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth7 = factor(oth7,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth6stt = factor(oth6stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth6 = factor(oth6,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth5stt = factor(oth5stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth5 = factor(oth5,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth4stt = factor(oth4stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth4 = factor(oth4,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth3stt = factor(oth3stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth3 = factor(oth3,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    
    oth2stt = factor(oth2stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth2 = factor(oth2,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    oth1stt = factor(oth1stt,
                     levels = c(0, 1),
                     labels = c('Initiated', 'Continued')),
    oth1 = factor(oth1,
                  levels = c(0, 1),
                  labels = c('Started before LP', 'Started after LP')),
    artstt = factor(artstt,
                    levels = c(0, 1),
                    labels = c('Initiated', 'Continued')),
    art = factor(art,
                 levels = c(0, 1),
                 labels = c('Started before LP', 'Started after LP')),
    ranppistt = factor(ranppistt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    ranppi = factor(ranppi,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    levitirastt = factor(levitirastt,
                         levels = c(0, 1),
                         labels = c('Initiated', 'Continued')),
    levitira = factor(levitira,
                      levels = c(0, 1),
                      labels = c('Started before LP', 'Started after LP')),
    phenystt = factor(phenystt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    pheny = factor(pheny,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    topirastt = factor(topirastt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    topira = factor(topira,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    valproicstt = factor(valproicstt,
                         levels = c(0, 1),
                         labels = c('Initiated', 'Continued')),
    valproic = factor(valproic,
                      levels = c(0, 1),
                      labels = c('Started before LP', 'Started after LP')),
    furosestt = factor(furosestt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    furose = factor(furose,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    mannitolstt = factor(mannitolstt,
                         levels = c(0, 1),
                         labels = c('Initiated', 'Continued')),
    mannitol = factor(mannitol,
                      levels = c(0, 1),
                      labels = c('Started before LP', 'Started after LP')),
    methylstt = factor(methylstt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    methyl = factor(methyl,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    dexamestt = factor(dexamestt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    dexame = factor(dexame,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    valganstt = factor(valganstt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    valgan = factor(valgan,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    acyclostt = factor(acyclostt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    acyclo = factor(acyclo,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    meropestt = factor(meropestt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    merope = factor(merope,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    ceftriastt = factor(ceftriastt,
                        levels = c(0, 1),
                        labels = c('Initiated', 'Continued')),
    ceftria = factor(ceftria,
                     levels = c(0, 1),
                     labels = c('Started before LP', 'Started after LP')),
    amphostt = factor(amphostt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    ampho = factor(ampho,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    flucostt = factor(flucostt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    fluco = factor(fluco,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    clindastt = factor(clindastt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    clinda = factor(clinda,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    pyrimestt = factor(pyrimestt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    pyrime = factor(pyrime,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    metronistt = factor(metronistt,
                        levels = c(0, 1),
                        labels = c('Initiated', 'Continued')),
    metroni = factor(metroni,
                     levels = c(0, 1),
                     labels = c('Started before LP', 'Started after LP')),
    cotrimostt = factor(cotrimostt,
                        levels = c(0, 1),
                        labels = c('Initiated', 'Continued')),
    cotrimo = factor(cotrimo,
                     levels = c(0, 1),
                     labels = c('Started before LP', 'Started after LP')),
    moxifstt = factor(moxifstt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    moxif = factor(moxif,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    levofstt = factor(levofstt,
                      levels = c(0, 1),
                      labels = c('Initiated', 'Continued')),
    levof = factor(levof,
                   levels = c(0, 1),
                   labels = c('Started before LP', 'Started after LP')),
    tbdrugstt = factor(tbdrugstt,
                       levels = c(0, 1),
                       labels = c('Initiated', 'Continued')),
    tbdrug = factor(tbdrug,
                    levels = c(0, 1),
                    labels = c('Started before LP', 'Started after LP')),
    xray = factor(xray,
                  levels = c(0, 1, 2),
                  labels = c('Normal',
                             'Compatible with TB',
                             'Abnormal but not necessarily TB')),
    extraclues = factor(extraclues,
                        levels = c(0, 1),
                        labels = c('No', 'Yes')),
    hivresult = factor(hivresult,
                       levels = c(0, 1, 2),
                       labels = c('Negative', 'Positive', 'Not done')),
    csfabnor = factor(csfabnor,
                      levels = c(0, 1, 2),
                      labels = c('Negative', 'Positive', 'Not done')),
    onsetstt = factor(onsetstt,
                      levels = c(0, 1), # Ambiguous 10-day cutoff
                      labels = c('Acute', 'Subacute')), 
    cnsinfec = factor(cnsinfec,
                      levels = c(0, 1, 2, 3),
                      labels = c('Confirmed', 'Probable',
                                 'Possible', 'Unlikely')),
    gradespec = factor(gradespec,
                       levels = c(1, 2, 3),
                       labels = c(
                         'Grade 1: GCS 15, no neurological deficiency',
                         'Grade 2: GCS 11-14, or CGS 15 + neurological deficit
                          (new focal neurological signs in this episode)',
                         'Grade 3: GCS  10'
                       )),
    monopare = factor(monopare,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    tetrapare = factor(tetrapare,
                       levels = c('No', 'Yes', 'Unknown'),
                       labels = c('No', 'Yes', 'Unknown')),
    parapare = factor(parapare,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    hemipare = factor(hemipare,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    motordef = factor(motordef,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    neckstiff = factor(neckstiff,
                       levels = c('No', 'Yes', 'Unknown'),
                       labels = c('No', 'Yes', 'Unknown')),
    papille = factor(papille,
                     levels = c('No', 'Yes', 'Unknown'),
                     labels = c('No', 'Yes', 'Unknown')),
    palsy = factor(palsy,
                   levels = c('No', 'Yes', 'Unknown'),
                   labels = c('No', 'Yes', 'Unknown')),
    cough = factor(cough,
                   levels = c('None', '<2 weeks', '>2 weeks', 'Unknown'),
                   labels = c('None', '<2 weeks', '>2 weeks', 'Unknown')),
    seizusym = factor(seizusym,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    bechsym = factor(bechsym,
                     levels = c('No', 'Yes', 'Unknown'),
                     labels = c('No', 'Yes', 'Unknown')),
    vomitsym = factor(vomitsym,
                      levels = c('No', 'Yes', 'Unknown'),
                      labels = c('No', 'Yes', 'Unknown')),
    headsym = factor(headsym,
                     levels = c('No', 'Yes', 'Unknown'),
                     labels = c('No', 'Yes', 'Unknown')),
    hivvalue = factor(hivvalue,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    gasbleed = factor(gasbleed,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),  
    urinary = factor(urinary,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Unknown')),  
    pupiref = factor(pupiref,
                     levels = c(0, 1, 2, 3),
                     labels = c('Normal', 'Sluggish', 'Absent', 'Unknown')),
    pupisz = factor(pupisz,
                    levels = c(0, 1),
                    labels = c('Normal', 'Anisocoria')),
    nerve12th = factor(nerve12th,
                       levels = c(0, 1, 2),
                       labels = c('No', 'Yes', 'Unknown')),  
    nerve7th = factor(nerve7th,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),  
    nerve6th = factor(nerve6th,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),
    nerve4th = factor(nerve4th,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),
    nerve3rd = factor(nerve3rd,
                         levels = c(0, 1, 2),
                         labels = c('No', 'Yes', 'Unknown')),
    heightmth = factor(heightmth,
                       levels = c(0, 1),
                       labels = c('Measured', 'Estimated')),
    armcirmea = factor(armcirmea,
                       levels = c(0, 1),
                       labels = c('Measured', 'Estimated')),
    weightmth = factor(weightmth,
                       levels = c(0, 1),
                       labels = c('Measured', 'Estimated')),
    loctemp = factor(loctemp,
                     levels = c(0, 1, 2),
                     labels = c('Axillary', 'Tympanic', 'Forehead')),
    hissmoking = factor(hissmoking,
                        levels = c(0, 1, 2),
                        labels = c('Currently', 'Previously', 'Never')),
    piefreshwt = factor(piefreshwt,
                        levels = c(0, 1, 2),
                        labels = c('No', 'Yes', 'Unknown')),
    pieanimal = factor(pieanimal,
                       levels = c(0, 1, 2),
                       labels = c('No', 'Yes', 'Unknown')),
    corticodur = factor(corticodur,
                        levels = c(1, 2, 3),
                        labels = c('<1 week',
                                   '1 week-1 month',
                                   '>1 month')),
    corticocurt = factor(corticocurt,
                         levels = c(0, 1, 2),
                         labels = c('No', 'Yes', 'Unknown')),
    diatherapy = factor(diatherapy,
                        levels = c(0, 1, 2, 3, 4),
                        labels = c('None',
                                   'Insulin',
                                   'Metformin',
                                   'Other',
                                   'Unknown')),
    diabetes = factor(diabetes,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),
    cnsfre = factor(cnsfre,
                    levels = c(1, 2),
                    labels = c('Once', 'More than once')),
    precns = factor(precns,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Unknown')),
    tbipt = factor(tbipt,
                   levels = c(0, 1, 2),
                   labels = c('No', 'Yes', 'Unknown')),
    tblatent = factor(tblatent,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),
    tbsttrec = factor(tbsttrec,
                      levels = c(0, 1, 2),
                      labels = c('Ongoing', 'Completed', 'Interrupted')),
    tbrecent = factor(tbrecent,
                      levels = c(0, 1, 2, 3, 4),
                      labels = c('<1 year',
                                 '1-3 years',
                                 '3-10 years',
                                 '>10 years',
                                 'Unknown')),
    tbfre = factor(tbfre,
                   levels = c(1, 2),
                   labels = c('Once', 'More than once')),
    pretb = factor(pretb,
                   levels = c(0, 1, 2),
                   labels = c('No', 'Yes', 'Unknown')),
    timettb = factor(timettb,
                     levels = c(1, 2),
                     labels = c('<=1 year', '>1 year')),
    treatedtb = factor(treatedtb,
                       levels = c(0, 1, 2),
                       labels = c('No', 'Yes', 'Unknown')),
    bcg = factor(bcg,
                 levels = c(0, 1, 2),
                 labels = c('No', 'Yes', 'Unknown')),
    nsweat = factor(nsweat,
                    levels = c(0, 1, 2),
                    labels = c('No', 'Yes', 'Unknown')),
    weightlost = factor(weightlost,
                        levels = c(0, 1, 2),
                        labels = c('No', 'Yes', 'Unknown')),
    seizufre = factor(seizufre,
                      levels = c(0, 1, 2, 3),
                      labels = c('No', 'Once', 'Repeated', 'Unknown')),
    seipattern = factor(seipattern,
                        levels = c(0, 1, 2),
                        labels = c('Focal', 'General', 'Unknown')),
    cranpsym = factor(cranpsym,
                      levels = c(0, 1, 2),
                      labels = c('No', 'Yes', 'Unknown')),
    seabsym = factor(seabsym,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Unknown')),
    moabsym = factor(moabsym,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Unknown')),
    lethsym = factor(lethsym,
                     levels = c(0, 1, 2),
                     labels = c('No', 'Yes', 'Unknown')),
    refstt = factor(refstt,
                    levels = c(1, 2, 3),
                    labels = c('Self-referral',
                               'Hospital referral',
                               'Primary health care')),
    studypl = factor(studypl,
                     levels = c(1, 2, 3),
                     labels = c('ER', 'Ward', 'Outpatient')),
    fstdosend = factor(fstdosend,
                       levels = c('Done', 'Not done'),
                       labels = c('Done', 'Not done')),
    lumpuncnd = factor(lumpuncnd,
                       levels = c('Done', 'Not done'),
                       labels = c('Done', 'Not done')),
    sex = factor(sex,
                 levels = c('Female', 'Male'),
                 labels = c('Female', 'Male')),
    hivvalue = factor(hivvalue,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    antiigg_res = factor(antiigg_res,
                         levels = c('Positive', 'Negative', 'Not done'),
                         labels = c('Positive', 'Negative', 'Not done')),
    hivstt = factor(hivstt,
                    levels = c('Positive', 'Negative', 'Not done'),
                    labels = c('Positive', 'Negative', 'Not done')),
    crag1 = factor(crag1,
                   levels = c('Positive', 'Negative', 'Not done'),
                   labels = c('Positive', 'Negative', 'Not done')),
    crag2 = factor(crag2,
                   levels = c('Positive', 'Negative', 'Not done'),
                   labels = c('Positive', 'Negative', 'Not done')),
    xpert1 = factor(xpert1,
                    levels = c('Positive', 'Negative', 'Not done'),
                    labels = c('Positive', 'Negative', 'Not done')),
    xpert2 = factor(xpert2,
                    levels = c('Positive', 'Negative', 'Not done'),
                    labels = c('Positive', 'Negative', 'Not done')),
    xpertrif1 = factor(xpertrif1,
                       levels = c('RIF-resistant', 'RIF-sensitive'),
                       labels = c('RIF-resistant', 'RIF-sensitive')),
    xpertrif2 = factor(xpertrif2,
                       levels = c('RIF-resistant', 'RIF-sensitive'),
                       labels = c('RIF-resistant', 'RIF-sensitive')),
    csfcmv1 = factor(csfcmv1,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfcmv2 = factor(csfcmv2,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfhsv1 = factor(csfhsv1,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfhsv2 = factor(csfhsv2,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfebv1 = factor(csfebv1,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfebv2 = factor(csfebv2,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfvzv1 = factor(csfvzv1,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfvzv2 = factor(csfvzv2,
                     levels = c('Positive', 'Negative', 'Not done'),
                     labels = c('Positive', 'Negative', 'Not done')),
    csfvdrl1 = factor(csfvdrl1,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    csfvdrl2 = factor(csfvdrl2,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    csftpha1 = factor(csftpha1,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    csftpha2 = factor(csftpha2,
                      levels = c('Positive', 'Negative', 'Not done'),
                      labels = c('Positive', 'Negative', 'Not done')),
    outcome = factor(outcome,
                     levels = c('Alive', 'Dead', 'Discharged',
                                'Self-discharged',
                                'Referred to another hospital',
                                'Hospitalised'),
                     labels = c('Alive', 'Dead', 'Discharged',
                                'Self-discharged',
                                'Referred to another hospital',
                                'Hospitalised')),
    etmtustt = factor(etmtustt,
                      levels = c('Definite', 'Probable', 'Possible'),
                      labels = c('Definite', 'Probable', 'Possible')),
    etitoxostt = factor(etitoxostt,
                        levels = c('Definite', 'Probable', 'Possible'),
                        labels = c('Definite', 'Probable', 'Possible')),
    eticrypstt = factor(eticrypstt,
                        levels = c('Definite', 'Probable', 'Possible'),
                        labels = c('Definite', 'Probable', 'Possible')),
    etibacstt = factor(etibacstt,
                       levels = c('Definite', 'Probable', 'Possible'),
                       labels = c('Definite', 'Probable', 'Possible')),
    etivencestt = factor(etivencestt,
                         levels = c('Definite', 'Probable', 'Possible'),
                         labels = c('Definite', 'Probable', 'Possible')),
    paticond = factor(paticond,
                      levels = c('Alive', 'Dead', 'Lost to follow up'),
                      labels = c('Alive', 'Dead', 'Lost to follow up'))) |>
  
  # Derived variables
  mutate(comppare = case_when(hemipare == 'Yes'|
                              parapare == 'Yes' |
                              tetrapare == 'Yes' |
                              monopare == 'Yes' ~ TRUE,
                              hemipare == 'No'&
                              parapare == 'No' &
                              tetrapare == 'No' &
                              monopare == 'No' ~ FALSE,
                              TRUE ~ NA)) |>
  
  # Include or exclude observed, cleaned variables
  mutate(
    hivstt = case_when(
      site == 'Jakarta' ~ hivstt,
      site == 'Bandung' ~ hivvalue,
      TRUE ~ NA_integer_
    )
  )
  
# Label variables
var_label(ibis) <- list(
  site = 'Study site',
  siteid = 'Study site ID',
  subjid = 'Unique patient ID',
  age = 'Age (years)',
  sex = 'Biological sex',
  symdays = 'Duration of symptoms (days)',
  feversym = 'Fever',
  feverday = 'Duration of fever (days)',
  headsym = 'Headache',
  headday = 'Duration of headache (days)',
  vomitsym = 'Vomiting',
  vomitday = 'Duration of vomiting (days)',
  alconsym = 'Altered conciousness',
  alconday = 'Duration of altered conciousness (days)',
  bechsym = 'Behavioural change',
  bechday = 'Duration of behavioural change (days)',
  seizusym = 'Seizure',
  seizuonset = 'Onset prior to baseline (days)',
  cough = 'Coughing',
  htemp = 'Highest recorded temperature at baseline (celcius)',
  gcs = 'Total GCS at baseline',
  palsy = 'Cranial nerve palsy',
  papille = 'Papilledema',
  neckstiff = 'Neck stiffness',
  motordef = 'Motor deficits',
  hemipare = 'Hemiparesis',
  parapare = 'Paraparesis',
  tetrapare = 'Tetraparesis',
  monopare = 'Monoparesis',
  hemovalue = 'Haemoglobin level (g/dL)',
  wcellcvalue = 'White blood cell count (in 1000 cells/L)',
  platevalue = 'Platelet count (in 1000 cells/L)',
  hivvalue = 'HIV test',
  cd4value = 'CD4 cell count (cells/L)',
  antiigg_res = 'Antitoxoplasma IgG',
  hivstt = 'HIV status',
  whcellc1 = 'Total white cell count (cells/L), 1',
  whcellc2 = 'Total white cell count (cells/L), 2',
  polycellc1 = 'Polymorphonuclear cell count (cells/L), 1',
  polycellc2 = 'Polymorphonuclear cell count (cells/L), 2',
  monocellc1 = 'Mononuclear cell count (cells/L), 1',
  monocellc2 = 'Mononuclear cell count (cells/L), 2',
  protein1 = 'Total protein (mg/dL), 1',
  protein2 = 'Total protein (mg/dL), 2',
  pblglucose1 = 'Paired blood glucose (mg/dL), 1',
  pblglucose2 = 'Paired blood glucose (mg/dL), 2',
  ratio_glucose1 = 'Glucose ratio, 1',
  ratio_glucose2 = 'Glucose ratio, 2',
  crag1 = 'Cryptococcal antigen test, 1',
  crag2 = 'Cryptococcal antigen test, 2',
  xpert1 = 'Gene Xpert, 1',
  xpert2 = 'Gene Xpert, 2',
  xpertrif1 = 'RIF resistance, 1',
  xpertrif2 = 'RIF resistance, 2',
  csfcmv1 = 'CSF PCR for CMV, 1',
  csfcmv2 = 'CSF PCR for CMV, 2',
  csfhsv1 = 'CSF PCR for HSV, 1',
  csfhsv2 = 'CSF PCR for HSV, 2',
  csfebv1 = 'CSF PCR for EBV, 1',
  csfebv2 = 'CSF PCR for EBV, 2',
  csfvzv1 = 'CSF PCR for VZV, 1',
  csfvzv2 = 'CSF PCR for VZV, 2',
  csfvdrl1 = 'CSF PCR for VDRL, 1',
  csfvdrl2 = 'CSF PCR for VDRL, 2',
  csftpha1 = 'CSF PCR for TPHA, 1',
  csftpha2 = 'CSF PCR for TPHA, 2',
  xraynm = 'Chest X-ray: Normal',
  xrayinf = 'Chest X-ray: Infiltrates',
  xraymili = 'Chest X-ray: Miliary',
  xraycav = 'Chest X-ray: Cavities',
  xray_ores = 'Chest X-ray: Other',
  bihernia1 = 'Herniation, 1',
  bihernia2 = 'Herniation, 2',
  bihernia3 = 'Herniation, 3',
  bienceph1 = 'Encephalitis, 1',
  bienceph2 = 'Encephalitis, 2',
  bienceph3 = 'Encephalitis, 3',
  staydur = 'Duration of stay (days)',
  outcome = 'Outcome',
  nonneuspec = 'Non-neuroinfection case, specified',
  etiomtuber = 'M. tuberculosis',
  etmtustt = 'M. tuberculosis status',
  etitoxoenc = 'Toxoplasma encephalitis',
  etitoxostt = 'Toxoplasma encephalitis status',
  eticryp = 'Cryptococcal meningitis',
  eticrypstt = 'Cryptococcal meningitis status',
  etibac = 'Bacterial meningitis',
  etibacstt = 'Bacterial meningitis status',
  etivence = 'Viral encephalitis',
  etivencestt = 'Viral encephalitis status',
  etiothba = 'Brain abcess',
  etiothmuco = 'Mucormycosis',
  etiothbm = 'Bacterial meningitis',
  etiothneu = 'Neurosyphilis',
  etiohtlym = 'Lymphoma',
  etiohnmdar = 'NMDAR encephalitis',
  etioothspec = 'Other aetiology',
  paticond = "Patient's condition",
  comppare = 'Presence of any paresis',
  initial = "Patient's initial"
)

# Exclude variables
ibis <- ibis |>
  select(-c(hivvalue, clindastt)) |> 
  rename(clindastt = clindastt0)

# Take a look at the cleaned dataset
glimpse(ibis)

# Save --------------------------------------------------------------------

ibis |> write_rds(here('0-data', 'ibis_all-cleaned.rds')) # R
ibis |> write_sav(here('0-data', 'ibis_all-cleaned.sav')) # SPSS
ibis |> write_dta(here('0-data', 'ibis_all-cleaned.dta')) # Stata

# Appendix ----------------------------------------------------------------

sessioninfo::platform_info()



















